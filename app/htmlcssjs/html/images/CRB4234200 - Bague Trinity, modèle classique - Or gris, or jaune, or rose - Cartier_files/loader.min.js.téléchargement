/*January 3, 2025, 11:17 am*/var vtstore;function checkInit(){var e,t=!1;try{t=!(0<=window.location.search.indexOf("vt_stop=true")),t=!(0<=document.cookie.indexOf("vt_stop"))&&t,t=!window.vt_stop&&t,window.ignore_vt_stop&&(t=!0),_vtsdk.state.running=t}catch(e){t=!1}window.top!==window.self&&(t=!1);try{0<=window.location.search.indexOf("vt_validate=true")&&(o=_vtsdk.Helpers.getURLParams(window.location.search),e=_vtsdk.Helpers.addQueryString(_vtsdk.defaults.validateUrl,o),_vtsdk.Helpers.getAsync(e),t=!1)}catch(e){}if(_vtsdk&&!0===_vtsdk.state.ready){t=!1;try{console.log("VTSDK ready.")}catch(e){}}if(t){for(var o,a=3,s=document.createElement("div"),n=s.getElementsByTagName("i");s.innerHTML="\x3c!--[if gt IE "+ ++a+"]><i></i><![endif]--\x3e",n[0];);t=9<=(a=a<=4?(o=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:|Edge\/)(\d+)/))?parseInt(o[1]):-1:a)||-1==a}t&&_vtsdk.init()}"object"!=typeof vtstore&&(vtstore={}),!function(e){e.vtstore=function(){function e(){try{return a in t&&t[a]}catch(e){return!1}}var n={},t=window,o=t.document,a="localStorage",s="script",r,i,c;if(n.disabled=!1,n.version="1.3.17",n.set=function(e,t){},n.get=function(e,t){},n.has=function(e){return n.get(e)!==undefined},n.remove=function(e){},n.clear=function(){},n.transact=function(e,t,o){o==null&&(o=t,t=null),t==null&&(t={});var a=n.get(e,t);o(a),n.set(e,a)},n.getAll=function(){},n.forEach=function(){},n.serialize=function(e){return JSON.stringify(e)},n.deserialize=function(t){if(typeof t!="string")return undefined;try{return JSON.parse(t)}catch(e){return t||undefined}},e())r=t[a],n.set=function(e,t){return t===undefined?n.remove(e):(r.setItem(e,n.serialize(t)),t)},n.get=function(e,t){var o=n.deserialize(r.getItem(e));return o===undefined?t:o},n.remove=function(e){r.removeItem(e)},n.clear=function(){r.clear()},n.getAll=function(){var o={};return n.forEach(function(e,t){o[e]=t}),o},n.forEach=function(e){for(var t=0;t<r.length;t++){var o=r.key(t);e(o,n.get(o))}};else if(o.documentElement.addBehavior){try{c=new ActiveXObject("htmlfile"),c.open(),c.write("<"+s+">document.w=window</"+s+'><iframe src="/favicon.ico"></iframe>'),c.close(),i=c.w.frames[0].document,r=i.createElement("div")}catch(e){r=o.createElement("div"),i=o.body}var l=function(o){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(r),i.appendChild(r),r.addBehavior("#default#userData"),r.load(a);var t=o.apply(n,e);return i.removeChild(r),t}},d=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),u=function(e){return e.replace(/^d/,"___$&").replace(d,"___")};n.set=l(function(e,t,o){return t=u(t),o===undefined?n.remove(t):(e.setAttribute(t,n.serialize(o)),e.save(a),o)}),n.get=l(function(e,t,o){t=u(t);var a=n.deserialize(e.getAttribute(t));return a===undefined?o:a}),n.remove=l(function(e,t){t=u(t),e.removeAttribute(t),e.save(a)}),n.clear=l(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(a);for(var o=t.length-1;o>=0;o--)e.removeAttribute(t[o].name);e.save(a)}),n.getAll=function(e){var o={};return n.forEach(function(e,t){o[e]=t}),o},n.forEach=l(function(e,t){var o=e.XMLDocument.documentElement.attributes;for(var a=0,s;s=o[a];++a)t(s.name,n.deserialize(e.getAttribute(s.name)))})}try{var p="__storejs__";n.set(p,p),n.get(p)!=p&&(n.disabled=!0),n.remove(p)}catch(e){n.disabled=!0}return n.enabled=!n.disabled,vtstore=n}()}(this),!function(e){var a,t,o,s,n,r;e.vtlodash=(s=function(e,t){var o=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&o===e},{isObject:function(e){return s("Object",e)},isArray:function(e){return s("Array",e)},merge:n=function(o){return[].slice.call(arguments,1).forEach(function(e){for(var t in e)t in o&&s("Array",o[t])?o[t]=o[t].concat(e[t]):t in o&&s("Object",o[t])?o[t]=n(o[t],e[t]):o[t]=e[t]}),o},overwrite:r=function(e,t){for(var o in e)e.hasOwnProperty(o)&&!a(t[o])&&(s("Object",e[o])&&s("Object",t[o])?e[o]=r(e[o],t[o]):e[o]=t[o]);return e},size:o=function(e){if(null==e)return 0;try{return(s("Array",e)?e:Object.keys(e)).length}catch(e){return 0}},isNull:function(e){return null===e},isNumber:function(e){return s("Number",e)},isBoolean:function(e){return s("Boolean",e)},isString:function(e){return s("String",e)},isFunction:t=function(e){return e&&"[object Function]"==={}.toString.call(e)},isUndefined:a=function(e){return void 0===e},isArguments:function(e){return s("Arguments",e)},isEmpty:function(e){return s("Object",e)&&s("Array",e)&&s("String",e)&&!t(e.splice)?!Object.keys(e).length:!o(e)},request:function(e,t){var o={bindFunction:function(e,t){return function(){try{return e.apply(t,[t])}catch(e){}}},stateChange:function(e){try{4==o.request.readyState&&o.callbackFunction(o.request.responseText)}catch(e){}},getRequest:function(){try{return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):!!window.XMLHttpRequest&&new XMLHttpRequest}catch(e){}}};if(o.postBody=arguments[2]||"",o.callbackFunction=t,o.url=e,o.request=o.getRequest(),o.request)try{var a=o.request;a.onreadystatechange=o.bindFunction(o.stateChange,o),""!==o.postBody?(a.open("POST",e,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("Content-type","application/x-www-form-urlencoded")):a.open("GET",e,!0),a.send(o.postBody)}catch(e){}}})}(this),window._vteq=window._vteq||[],window._vtsdk&&!window.ignore_vt_stop||(window._vtsdk=function(){var documentAlias=document,windowAlias=window,object={v:"20.9.5",defaults:{tags:{prefix:"**|",suffix:"|**"},cdns:[4],cookieNames:{all:"all",ne:"ne",push:"pushtkn",ts:"ts",shop:"shop",sess:"sess",uId:"user",webid:"webid",debug:"debug",backendCache:"bcache",stopevents:"stopevents",campaignsStatus:"cs",condCount:"count",visitor:"info",capping:"cap_",poll:"poll",contentStep:"cstep_",cStatus:"c_"},debug:"info",queueCheckInterval:500,visitorHost:"https://pro.ip-api.com/json/?key=aUoasJP8dMuydUf",visitorCallback:"_vtsdk.tasks.callbackVisitor",eventHost:"https://app.cybba.solutions/event/",eventCallback:"_vtsdk.eventApi.callbackEvent",reccsHost:"https://rec.cybba.solutions/html/",reccsCallbackContent:"_vtsdk.Recommender.callBackRecommenderContent",reccsCallbackTwo:"_vtsdk.Recommender.callBackRecommenderTwo",userHost:"https://app.cybba.solutions/user",userCallback:"_vtsdk.User.callbackUser",backendHost:"https://rec.cybba.solutions/check/",backendCallback:"_vtsdk.Campaign.triggerCampaigns",cacheBackendCheck:"_vtsdk.Campaign.cacheBackendCheck",mcUrl:"https://pages.cybba.solutions/integrations/mailchimp.php",validateUrl:"https://pages.cybba.solutions/tasks/util/jsValidation.php",prefix:"_vt_",monthDuration:2592e6,dayDuration:864e5,shortDuration:36e6,sessionDuration:432e5,expiration:31536e6,nowTime:(new Date).getTime(),nowTimeLocal:(new Date).getTime(),userIndentityParams:["vt_user","email"],userKeyLength:16,loaderGif:"https://files1.cybba.solutions/_assets/images/ajax-loader.gif",stylesheet:"https://files1.cybba.solutions/_assets/vtmarketing.min.css",idPrefix:"vt-campaign-",recc:{className:"vt-campaign",attributeId:"data-vt-id",cIdLength:7},siteEvents:{click:"siteclick",submit:"sitesubmit",display:"sitedisplay",close:"siteclose",referer:"referer"},siteClasses:{close:"vtw-close",click:"vtw-click",overlay:"vtw-bck",toggle:"vtw-toggle",error:"vtw-error",attr:"vtw-attr",attrPrefix:"vta-",classPrefix:"vtw-",submit:"vtw-submit",required:"vtw-required",invalid:"vtw-invalid"}},state:{timeDiff:0,hasLoaded:!1,waitUserRequest:!1,ready:!1,hasUser:!1,pageQueue:[],reccCampaigns:[],calledRecommender:!1,emailToPush:!1,reccTpls:{},campaignsOK:[],pageCampaigns:{},inactivityCampaigns:[]}};return object.defaults.userIndentityParams.push("utm_ra"),object.shop={id:1600,url:"https://www.cartier.fr",params:{getVisitorInfo:!0,emailGrab:!0,customJS:"if(!!~window.location.href.indexOf('collections') && !!~window.location.href.indexOf('.html') && document.querySelector('.js-pdp__cta-section--product-ref-id .local-ref') !== null){\n    try{\n        if(document.querySelectorAll('.product-sku-sizes.button.tiny.in-stock')){\n           window.cybSKU = document.querySelector('.js-pdp__cta-section--product-ref-id .local-ref').innerText.toLowerCase();\n           window._vteq.push({\n               \"viewitem\": {\n                   itemId: cybSKU\n               }\n           });\n        }\n        if(document.querySelector('.btn-add-to-basket')){\n            document.querySelector('.btn-add-to-basket').addEventListener(\"click\",function(){\n                window._vteq.push({\n                    addtocart: {\n                        itemId: cybSKU,\n                        cartId: Date.now()\n                    }\n                });\n            });\n        }\n    }catch(e){}\n}else if(window.location.href.toLowerCase().indexOf(\"search-results.html?kwcar=\") >= 0){\n    window._vteq.push({\n        \"search\": {\n            query: decodeURIComponent(urlParamCYB('kwCAR'))\n        }\n    });\n}\nwindow.upDateUserIDCYB =  function(){\n    if(!!~window.location.search.indexOf('vt_user')){\n        let cybID=urlParamCYB('vt_user');        \n        setCookieCYB('CYB_ID', cybID);\n    }\n}\nwindow.waitForTotalElementCYB=function(){\n    if(document.querySelector('.price .value') && document.querySelector('.price .value').getAttribute('data-ytos-price') && !!~window.location.href.toLowerCase().indexOf('onepagecheckout')) {\n        setCookieCYB('cybPrice',document.querySelector('.price .value').getAttribute('data-ytos-price'))\n    }else{\n        setTimeout(waitForTotalElementCYB, 250);\n    }\n}\n// this embeds the campaigns into the onsite or on a site\nwindow.cybReccomender = function(){\n    _vtsdk.Recommender.embedMerchandisingCampaigns();\n    _vtsdk.Recommender.getData();\n}\nif(document.querySelector('.breadcrumbs .crumb.level_2 a')){\n    let breadcrumbUrl = document.querySelector('.breadcrumbs .crumb.level_2 a').href\n    if (!!~breadcrumbUrl.indexOf('montres')) {\n        _vteq.push({\n            'event': {\n                'event_name': 'category',\n                'cat': 'watch'\n            }\n        });\n    } else if (!!~breadcrumbUrl.indexOf('maroquinerie')) {\n        _vteq.push({\n            'event': {\n                'event_name': 'category',\n                'cat': 'leather'\n            }\n        });\n    } else if (!!~breadcrumbUrl.indexOf('joaillerie')) {\n        _vteq.push({\n            'event': {\n                'event_name': 'category',\n                'cat': 'jewelry'\n            }\n        });\n    } else{\n        _vteq.push({\n          'event': {\n              'event_name': 'category',\n              'cat': 'jewelry'\n          }\n        });\n    }\n}else if (document.querySelector('.iconbox__number.js-cart-count') && document.querySelector(\".row.c-collection-block,.c-collection-link,.listing-heading.view-specific,.c-pdp__cta-section--product-description\") && document.querySelector(\".c-breadcrumb__list-item.active\")) {\n    if (Number(document.querySelector('.iconbox__number.js-cart-count').innerText) > 0) {\n        if (!!~window.location.pathname.indexOf('montres')) {\n            _vteq.push({\n                'event': {\n                    'event_name': 'category',\n                    'cat': 'watch'\n                }\n            });\n        } else if (!!~window.location.pathname.indexOf('maroquinerie')) {\n            _vteq.push({\n                'event': {\n                    'event_name': 'category',\n                    'cat': 'leather'\n                }\n            });\n        } else if (!!~window.location.pathname.indexOf('joaillerie')) {\n            _vteq.push({\n                'event': {\n                    'event_name': 'category',\n                    'cat': 'jewelry'\n                }\n            });\n        } else{\n            _vteq.push({\n              'event': {\n                  'event_name': 'category',\n                  'cat': 'jewelry'\n              }\n            });\n        }\n    }\n}\n\n/*\nif (document.querySelector('#shippingForm_firstName1, [name=\"ShippingAddressFormViewModel.Surname\"]')) {\n    document.querySelector('#shippingForm_firstName1, [name=\"ShippingAddressFormViewModel.Surname\"]').addEventListener(\"blur\", function () {\n        _vteq.push({\n            \"update\": {\n                \"firstname\": document.querySelector('#shippingForm_firstName1, [name=\"ShippingAddressFormViewModel.Surname\"]').value\n            }\n        });\n    });\n}*/\nif (document.querySelector('#billingForm_firstName1, [name=\"BillingAddressFormViewModel.Name\"]')) {\n    document.querySelector('#billingForm_firstName1, [name=\"BillingAddressFormViewModel.Name\"]').addEventListener(\"blur\", function () {\n        _vteq.push({\n            \"update\": {\n                \"firstname\": document.querySelector('#billingForm_firstName1, [name=\"BillingAddressFormViewModel.Name\"]').value\n            }\n        });\n    });\n}\n/**********************START USER INPUT**************************************/\nwindow.cybData = {};\n\n// Initialization function - allows for customization of basic settings \nwindow.configSettingsCYB = function() {\n    // Various Settings\n    cybData.allowLogs = true; //True to enable debug logs, does not turn off console.log - this will be on by default in staging\n    cybData.cookieStaging = false; //Initalizes cookie staging mode if true and panel will only fire with the cookie - MUST BE FALSE WHEN LIVE (cybbatest=true)\n    \n    cybData.safeDomains = []; // Add all domains allowed to trigger tools on, required for V2, optional for V1\n    \n    //Trigger Rules for ONSITE\n    cybData.exitIntent = true;\n    cybData.onClose = false; // true/false\n    cybData.deskInactivity = 0; //time in seconds\n    cybData.mobileInactivity = 0; //time in seconds\n    cybData.mobileExit = false; // true/false - Firings on buttons from browser/OS\n    cybData.ABtest = [50, 50]; //Percentage of Firing per agent - sets Cookie \"CYB_AB\" with the index of the agent to be fired\n    cybData.sessionMgmt = {\n        timesPerSession: 1, // Times the Onsite can fire per session without the cookie dropping\n        hours: 2 // Time in hours when the onsite can next fire. \n    };\n    cybData.triggerSensitivity = 0.75; // delay for mouse to be outside of browser to delay firing panel \n    cybData.fireTowardsX = [false, 25, 75]; // True if only firing panel when users goes towards the corners of the browser, % for left hand side, % for right hand side\n    cybData.pageForms = []; //add selectors to the array for any forms or elements that should not trigger onsite\n    cybData.addCSS = ''; //add minified CSS for custom CSS here\n    cybData.copiedText = ''; // Text for Copy Success Message, Default is \"COPIED!\" if left blank \n    cybData.SMS = {\n        enabled: false,\n        campaigns: {\n            'EMAILTEMPLATEID' : \"TEMPLATEID\"\n        }\n    }\n\n    cybData.onsiteCountDown = { //if enabled and onsite has id='onsiteCountDown' (case insensitive)\n        enabled: false,\n        time: 'Jan 1, 2019 00:00:00', // must be date, number (getTime()), or date string\n        closeOnExpiration: false, // Close onsite after time expiration\n        expiredText: \"EXPIRED\",\n        padNums: true, // shows 09 instead of 9\n        hideZeroes: false, // does not show 0m 30s, instead shows 30s\n        /* ADD THIS HTML TO ONSITE FOR IT TO WORK PROPERLY\n        <div class=\"countdown-timer\" id=\"onsiteCountDown\" style=\"display:inline\"> \n            <span class=\"cDays\"></span><span> d : </span>\n            <span class=\"cHours\" style=></span><span> h : </span>\n            <span class=\"cMins\"></span><span> m : </span>\n            <span class=\"cSecs\"></span><span> s</span>\n         </div>*/\n    }\n    \n    /** START PROMOBAR DATA **/\n    cybData.promoBarData = {\n        'IDHERE': { // One object per promobar\n            enabled: false, //True for live, false for off\n            position: 'top',\n            countDown: { //if enabled and onsite has id='cybCountDown' (case insensitive)\n                countDownDate: 'Jan 1, 2019 00:00:00', // must be date, number (getTime()), or date string\n                countDownExpirationClose: false, // Close promobar after time expiration\n                countDownExpireText: \"EXPIRED\",\n                hasLetters: true, // eg. 4d 6h 2m 10s vs 4:6:2:10\n                padNums: true, // shows 09 instead of 9\n                hideZeroes: false, // does not show 0m 30s, instead shows 30s,\n                syncTime: false // Have time synchronized to initial fire\n            },\n            triggers: {\n                onload: {\n                    enabled: false,\n                    conditionally: true //false will fire the same one every load, true will check filters first\n                },\n                afterOE: { //Fires after an Onsite, on next reload\n                    enabled: false,\n                    checkFilters: true\n                },\n                mobile: true,\n                onOEClose: {\n                    enabled: false,\n                    onsiteId :'', //Fires immediately after X button closed on the onsite\n                    conditionally: false\n                },\n                exitIntent: false,\n                persist: { // promobar persists after initial fire dependent on filters, also works to just filter after CYBSession cookie exists\n                    enabled: false,\n                    conditionally: false //false will fire the same one every load, true will check filters first\n                },\n                inactivity: 0\n            },\n            sessionMgmt: {\n                enabled: true,\n                timesPerSession: 1,\n                hours: 2\n            },\n            stickyNav: {\n                hasStickyNav: false,\n                selector: ''\n            },\n            customJS : { //add JS to run on load or close of promobar\n                load: \"\",\n                close: \"\"\n            }\n        }\n    }\n    /** END PROMOBAR DATA **/\n\n    //Dynamic Product Data\n    cybData.dynamicProductData = {\n        history: false, // true for history features\n        histObjCYB: { // selectors for product page (history) data - leave blank if not using\n            pName: \"\",\n            pPrice: \"\",\n            pImg: \"\",\n            pUrl: window.location.href\n        },\n        addImageURLPrefix: '', // use if you need to add domain or protocol to URL\n        imageIsSource: true, // true if trying to grab image src, false if image is a background image in the CSS\n        viewButtonText: 'View Item',\n        historyTabText: 'History'\n    };\n\n    // Lowers Z-Index of any element that is in-front of the onsite\n    cybData.resetZIndex = {\n        enabled: false,\n        selectors: ['']\n    };\n\n    cybData.eventFunctions = {\n        onsiteOnload: {\n            // set CAMPAIGNID to all to load for all creatives\n            'CAMPAIGNID' : 'JS HERE' //Put in Campaign ID or 'all' here to run JS on campaign display\n        },\n        onsiteOnClose: {\n            // set CAMPAIGNID to all to load for all creatives\n            'CAMPAIGNID' : 'JS HERE' //Put in Campaign ID or 'all' here to run JS on campaign close\n        },\n        onsiteOnClick:{\n            // set CAMPAIGNID to all to load for all creatives\n            'CAMPAIGNID' : 'JS HERE' //Put in Campaign ID or 'all' here to run JS on campaign CTA click\n        }\n    }\n\n    cybData.forceCSS = {\n        'SELECTOR': 'CSSHERE'\n    };\n\n    cybData.promptConfig = {\n        attribution: true,\n        applySessionMgmt: true\n    }\n    \n    //Do not remove or modify this call\n    try {setTimeout(initCYB, 500)} catch (e){console.log(e);}\n}\n//Code all things you need to have excute on load here\nwindow.onloadFunctionsCYB = function(){\n   //waitForConsentElementCYB();\n    waitForCartElementCYB();\n    waitForTotalElementCYB();\n    upDateUserIDCYB();\n}\n\n// Criteria Filters Here\nwindow.cybbaFilters= function(){}\n\n// Promobar Criteria Filters Here\nwindow.promobarFilters= function(){}\n\n/******DO NOT REMOVE********/\nsetTimeout(configSettingsCYB, 1000);\n/******DO NOT REMOVE********/",listenFields:"",referer:!0,hasActTriggers:!1,hasSendActTriggers:!1,hasRunningInteractions:!1,hasRunningContent:!1,hasRunningAds:!1,countConditions:[],webidTags:[],getVisitorWebid:!1,pageJS:[]},agency:108,_id:1600,debug:"none",domain:"cartier.fr",campaigns:{},content:{campaigns:{}},adserver:{}},object.User={data:{},context:{vars:{pageType:""}},getLocalUser:function(){var e,t=object.Helpers.readCookie(object.defaults.prefix+object.defaults.cookieNames.uId);return null!=t?(t={userId:(e=t.split("_"))[0],sessionId:"1",email:"true"==e[2],push:"true"==e[3],tel:"true"==e[4],isC:"true"==e[5],noP:e[6]?parseInt(e[6]):0},object.Helpers.setCookie(object.defaults.cookieNames.uId,t)):(t=object.Helpers.getCookie(object.defaults.cookieNames.uId),vtlodash.isObject(t)&&object.Helpers.setCookie(object.defaults.cookieNames.uId,t)),!vtlodash.isEmpty(t)&&t||null},requestUser:function(e){var t;!0===object.state.waitUserRequest||(e=e||{},t={callback:object.defaults.userCallback,shopId:object.shop.id,oldUserId:object.User.data.userId},object.Helpers.log("Requesting user data: "+object.User.data.userId+"new "+JSON.stringify(e),"info"),e.userId&&(t.userId=e.userId),e.uuid&&(t.uuid=e.uuid),e.email&&object.Helpers.emailIsValid(e.email)?(t.email=e.email,vtlodash.isFunction(windowAlias.btoa)&&(t.email=windowAlias.btoa(t.email))):t.email=null,e=object.Helpers.addQueryString(object.defaults.userHost,t),object.state.botagent)||(object.Helpers.getAsync(e),object.state.waitUserRequest=!0)},isIdentified:function(){return!!object.User.data.email||!!object.Helpers.emailIsValid(object.User.data.email)},changeUserByEmail:function(e){e=object.Helpers.cleanEmail(e),object.Helpers.emailIsValid(e)&&object.User.requestUser({email:e})},changeUserById:function(e){object.User.data.userId!==""+e&&object.User.requestUser({userId:e})},changeUserByUuid:function(e){object.User.data.uuid!==""+e&&object.User.requestUser({uuid:e})},callbackUser:function(e){object.Helpers.log("Callback User server data","info");var t={sessionId:"1"};e.userId&&(t.userId=e.userId),t.email=!!e.email,t.push=!!e.push,t.noP=0,t.isC=!1,e.isCustomer&&(t.isC=e.isCustomer||!1),e.numberOfPurchases&&(t.noP=e.numberOfPurchases||0),e.ts&&(e=object.defaults.nowTimeLocal-parseInt(e.ts),object.Helpers.setCookie(object.defaults.cookieNames.ts,e=100<e?e:1,object.defaults.dayDuration),object.defaults.nowTime-=e),object.Helpers.setCookie(object.defaults.cookieNames.uId,t),object.User.data.userId!=t.userId&&(object.state._vtolduser=object.User.data.userId),object.User.data=t,object.state.hasUser=!0,object.User.context&&object.User.context.all&&(object.User.context.all.hasEmail=object.User.isIdentified(),object.User.context.all.hasPush=!!object.User.data.push,object.User.context.all.hasTel=!!object.User.data.tel,object.User.context.all.isCustomer=!!object.User.data.isC,object.User.context.all.noPurchases=object.User.data.noP||0),object.state.loginToPush&&(object.state.eventQueue.push(object.state.loginToPush),delete object.state.loginToPush),object.state.waitUserRequest=!1},activityInit:function(){var t,o,e,a,s,n;function r(){var e=Date.now()-object.state.lastActiveTime,e=(o<e&&(object.Campaign.triggerInactivityCampaigns(e/1e3),a+=1),t&&clearInterval(t),o+1e3*a);e<12e4&&(t=windowAlias.setTimeout(r,e))}function i(){object.state.lastActiveTime=Date.now(),a=1,object.shop.params.hasSendActTriggers&&(!object.state.lastCallActive||object.state.lastActiveTime-object.state.lastCallActive>e)&&(object.User.activitySend(a),object.Helpers.log("Sending activity","info"))}(object.shop.params.hasActTriggers||object.shop.params.hasSendActTriggers)&&(o=5e3,e=12e4,object.state.lastActiveTime=Date.now(),a=0,s=document.documentElement,n=document,object.Helpers.addEventListener(s,"mousedown",i,!0),object.Helpers.addEventListener(s,"keypress",i,!0),object.Helpers.addEventListener(n,"touchmove",i,!0),object.Helpers.addEventListener(n,"scroll",i,!0),r())},activitySend:function(e){object.Helpers.log("Updating server user activity for check "+e,"info"),object.state.lastCallActive=object.state.lastActiveTime;e={shopId:object.shop.id,userId:object.User.data.userId,ts:object.state.lastActiveTime},e=object.Helpers.addQueryString(object.defaults.userHost+"/active",e);object.Helpers.getAsync(e)}},object.eventApi={convertEventObject:function(e){var t,o={type:""};for(t in e)if(e.hasOwnProperty(t)){o.type=t;var a=vtlodash.isObject(e[t])?JSON.parse(JSON.stringify(e[t])):{};if("confirmation"===t&&1<vtlodash.size(a))try{o.items=a.items||[],o.generic=a.generic||{},["orderId","total","email"].forEach(function(e,t){a[e]&&(o.generic[e]=a[e])}),a={}}catch(e){object.Helpers.log("Error creating generic for confirmation ","error")}"event"===t&&(o.type="generic",o.generic=e.event,o.generic.event_name&&(o.generic.event_name=object.eventApi.formatEventName(o.generic.event_name)),a={}),"addtocart"!=t&&"viewitem"!=t&&"addtowishlist"!=t||!a.itemId||(a.itemId=(""+a.itemId).trim(),object.setVar("itemId",a.itemId)),"viewcategory"==t&&a.category&&(a.category=(""+a.category).trim().toLowerCase().replace(/\s/g,"_"),object.setVar("category",a.category)),"search"==t&&a.query&&(a.query=(""+a.query.replace(/"/g,"'")).trim(),object.setVar("query",a.query),a.query=a.query.toLowerCase()),"pageview"==t&&a.url&&(0<a.url.indexOf("#")&&(a.url=a.url.substring(0,a.url.indexOf("#"))),a.url=encodeURIComponent(a.url)),a.device=object.User.context.session.deviceType,o=vtlodash.merge(o,a),vtlodash.isFunction(windowAlias.btoa)&&o.email&&(o.email=windowAlias.btoa(o.email))}return object.state._vtsid&&(o._vtsid=object.state._vtsid),o},formatEventName:function(e){return e.trim().toLowerCase().replace(/\s/g,"_")},sendEventArray:function(e){if(object.Helpers.log("Received array events "+JSON.stringify(e),"info"),vtlodash.isArray(e)&&(ret_array=[],!object.state.botagent)){for(var t=object.Helpers.getCookie(object.defaults.cookieNames.uId),o=0;o<e.length;o++){var a=e[o],s={userId:t.userId},a=object.eventApi.convertEventObject(a),s=vtlodash.merge(s,a);ret_array.push(s)}var n={data:JSON.stringify(ret_array),callback:object.defaults.eventCallback},r=object.defaults.eventHost+object.shop.id+"/"+a.type,r=object.Helpers.addQueryString(r,n);object.Helpers.getAsync(r)}},pushNext:function(e){object.Helpers.setCookie(object.defaults.cookieNames.ne,e)},sendEvent:function(e){try{object.Helpers.log("Received event "+JSON.stringify(e),"info")}catch(e){}var t,o,a;if(!object.state.botagent)return e=object.eventApi.convertEventObject(e),object.eventApi.validateEvent(e,!0)?(t={userId:(o=object.Helpers.getCookie(object.defaults.cookieNames.uId)).userId},o.userId!=object.User.data.userId&&(t._vtolduser=object.User.data.userId),object.state._vtolduser&&(t._vtolduser=object.state._vtolduser,delete object.state._vtolduser),t=vtlodash.merge(t,e),o={data:JSON.stringify(t),callback:object.defaults.eventCallback},("update"==e.type&&t.lastVisitDate||"siteclose"==e.type)&&(o._bqstore=0),a=object.defaults.eventHost+object.shop.id+"/"+e.type,a=object.Helpers.addQueryString(a,o),object.Helpers.getAsync(a),object.Helpers.sendToAnalytics(t),!0):(object.Helpers.log("Event not valid "+JSON.stringify(e),"error"),!1)},callbackEvent:function(e){var t;vtlodash.isObject(e)&&(t=JSON.stringify(e)),object.Helpers.log("Event received "+t,"info"),e.userId!==object.User.data.userId&&(object.Helpers.log("New session for user ","info"),(t=object.User.data).sessionId="1",t.userId=e.userId,vtlodash.isEmpty(t)||object.Helpers.setCookie(object.defaults.cookieNames.uId,t))},hashEvent:function(e){return btoa(unescape(encodeURIComponent(JSON.stringify(object.Helpers.getSortedDict(e)))))},validateEvent:function(e,t){if("viewitem"==e.type&&!e.itemId)return!1;if("login"==e.type&&!e.email&&!e.uuid&&!e.userId)return!1;if("viewcategory"==e.type&&!e.category)return!1;if("addtocart"==e.type&&!e.itemId)return!1;if("addtowishlist"==e.type&&!e.itemId)return!1;if("search"==e.type&&!e.query)return!1;if("generic"==e.type&&!e.generic.event_name)return!1;if("confirmation"==e.type&&e.generic&&e.generic.orderId){if(object.User.context.all.orderId===e.generic.orderId)return!1;object.Helpers.updateCookie(object.defaults.cookieNames.all,{orderId:e.generic.orderId}),object.User.context.all.orderId=e.generic.orderId}if(t){object.state.guardEvents=object.state.guardEvents||[];t=object.eventApi.hashEvent(e);if(0<=object.state.guardEvents.indexOf(t))return object.Helpers.log("Event already sent","info"),!1;object.state.guardEvents.push(t)}return!0}},object.Helpers={getContextValue:function(e,t,o){var a=object.Helpers.getDeepValue(object.User.context,e);if("all.hasEmail"===e&&(a=object.User.isIdentified()),0==e.indexOf("cookie.")&&(a=object.Helpers.readCookie(e.split(".").splice(1).join("."))),0==e.indexOf("jsvar.")&&(a=object.Helpers.getDeepValue(windowAlias,e.split(".").splice(1).join("."))),"e"==t&&o&&"session.vte."+o.type===e)switch(o.type){case"viewitem":case"addtocart":case"addtowishlist":a=o.itemId||"";break;case"search":a=o.query||"";break;case"viewcategory":a=o.category||""}return a},getDeepValue:function(e,t){try{if(t){for(var o=t.split("."),a=0;a<o.length;a++)if(void 0===(e=e[o[a]]))return;return e}}catch(e){object.Helpers.log("Error extracting deep value","error")}},returnRandomZoneBanners:function(e,t){if(!vtlodash.isArray(e)||t<1)return!1;for(var o,a,s=e.length;0!==s;)a=Math.floor(Math.random()*s),o=e[--s],e[s]=e[a],e[a]=o;return(e=object.Helpers.returnValidZoneBanners(e)).slice(0,t)},returnValidZoneBanners:function(e){for(var t=[],o=0;o<vtlodash.size(e);){var a=e[o];object.Campaign.checkDisplayLimits(a.tpl,object.shop.adserver.campaigns[a.campaign].siteParams.banners[a.tpl])&&object.shop.adserver.templates[a.tpl]&&t.push(a),o++}return t},cleanEmail:function(e){return e&&e.replace(/[\s\'\"\/\\#]/g,"").toLowerCase()},extractTagFromHtml:function(e,t){return e&&t&&(t=new RegExp("<"+t+"[^>]*>([\\s\\S]*?)<\\/"+t+">","i"),result=t.exec(e),vtlodash.isArray(result))&&0<result.length?result[1]:""},addClass:function(e,t){if(_vtsdk.Helpers.isDomNode(e))e.classList.add(t);else try{for(var o=0;o<e.length;o++)e[o].classList.add(t)}catch(e){}},removeClass:function(e,t){if(_vtsdk.Helpers.isDomNode(e))e.classList.remove(t);else try{for(var o=0;o<e.length;o++)e[o].classList.remove(t)}catch(e){}},serializeForm:function(e){var t,o,a=[];if("object"==typeof e&&"FORM"==e.nodeName){var s=e.elements.length;for(i=0;i<s;i++)if((t=e.elements[i]).name&&!t.disabled&&"file"!=t.type&&"reset"!=t.type&&"submit"!=t.type&&"button"!=t.type)if("select-multiple"==t.type)for(o=e.elements[i].options.length,j=0;j<o;j++)t.options[j].selected&&(a[a.length]=t.name+"="+t.options[j].value);else("checkbox"!=t.type&&"radio"!=t.type||t.checked)&&(a[a.length]=t.name+"="+t.value)}return a},serializeObjectForm:function(e){var a,s;if("object"==typeof e&&"FORM"==e.nodeName&&window.FormData)return a=new FormData(e),s={},Object.keys(a).forEach(function(e,t){var o=a[e];e=e.replaceAll("[","").replaceAll("]","").replaceAll("form",""),void 0!==s[e]?(Array.isArray(s[e])||(s[e]=[s[e]]),s[e].push(o)):s[e]=o}),s},pickRandomPercentages:function(e){var t,o,a,s=100*Math.random();t=0;for(o in e)if(a=t,t+=e[o],a<=s&&s<=t)return o;throw new Error("Could not pick any number for items "+e)},generateRandomBetween:function(e,t,o){return o?Math.floor(Math.random()*(t-e))+e:Math.random()*(t-e)+e},valuesComparer:function(val1,val2,op){if(val1="false"!==val1&&("true"===val1||val1),val2="false"!==val2&&("true"===val2||val2),!1===val2&&vtlodash.isUndefined(val1)&&"eq"==op)return!0;if(0===val2&&vtlodash.isUndefined(val1)&&0<=["eq","lte","gte"].indexOf(op))return!0;switch(op){case"gt":return val2<val1;case"gte":return val2<=val1;case"lt":return val1<val2;case"lte":return val1<=val2;case"eq":return val1===val2;case"ne":return val1!=val2;case"in":return-1!==val2.indexOf(val1);case"nin":return-1===val2.indexOf(val1);case"regex":var r;return vtlodash.isUndefined(val1)?!1:(r=new RegExp(val2),!!r.test(val1));case"eval":try{var x=eval(val2.replace(/\(x\)/g,val1))}catch(er){var x=!1}return!!vtlodash.isBoolean(x)&&x}return!1},getSortedDict:function(t){var o;return vtlodash.isObject(t)?(o={},Object.keys(t).sort().forEach(function(e){o[e]=object.Helpers.getSortedDict(t[e])}),o):t},addEventListener:function(e,t,o,a){return a=!vtlodash.isUndefined(a)&&a,e.addEventListener?(e.addEventListener(t,o,a),!0):e.attachEvent?e.attachEvent("on"+t,o):void(e["on"+t]=o)},getAsync:function(e,t){void 0===t&&(e+=(-1==e.indexOf("?")?"?":"&")+"_ts="+String(Math.round(1e8*Math.random())));t=object.Helpers.embedTag("script","","head",{type:"text/javascript",src:e});try{t.async=!0}catch(e){}return t},vtPostMessage:function(){object.Helpers.addEventListener(windowAlias,"message",function(e){e=e.data;try{(e=JSON.parse(e))._vt&&(e.setVar&&isArray(e.setVar)?object.setVar(e.setVar[0],e.setVar[1]):e.event&&object.eventApi.sendEvent(e.event))}catch(e){}},!1)},emailIsValid:function(e){e=object.Helpers.cleanEmail(e);return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},log:function(e,t){var o=(new Date).getTime()-object.defaults.nowTimeLocal,a=(t=t||"info",e=vtlodash.isObject(e)?JSON.stringify(e):e,{info:1,warning:2,error:3,none:4});if(a[object.defaults.debug]<=a[t])try{console.log("["+t+"]["+o+"]"+e)}catch(e){}},setAnalyticsUser:function(){object.shop.ganalytics&&!0===object.shop.ganalytics.status&&window.gtag&&window.gtag("set",{user_id:object.User.data.userId})},setAnalyticsSource:function(e,t){var o;object.shop.ganalytics&&!0===object.shop.ganalytics.setSource&&(o=setInterval(function(){void 0!==window.gtag&&(window.gtag("set",{campaign_id:e,campaign_name:"vt_"+e,campaign_source:object.shop.ganalytics.category,campaign_medium:t}),clearInterval(o))},100),setTimeout(function(){clearInterval(o)},1e3))},sendToAnalytics:function(t){var o;object.shop.ganalytics&&!0===object.shop.ganalytics.status&&window.gtag&&(object.shop.ganalytics.events.length&&object.shop.ganalytics.events.indexOf(t.type)<0||(o=setInterval(function(){var e="";try{switch(t.type){case"viewitem":case"addtocart":case"addtowishlist":e=t.itemId;break;case"viewcategory":e=t.category;break;case"checkout":e=t.step||"";break;case"sitesubmit":case"siteclick":case"siteclose":case"sitedisplay":e=t.tracking.vt_campaign+"_"+t.tracking.vt_content;break;case"search":e=t.query;break;case"confirmation":e=(t.orderId?t.orderId+"_":"")+(t.items?t.items.length:0)}}catch(e){object.Helpers.log("Error building opt_label for analytics","error")}void 0!==window.gtag&&(window.gtag("event","vt_"+t.type,{category:object.shop.ganalytics.category,label:e}),clearInterval(o))},100),setTimeout(function(){clearInterval(o)},1e3)))},getStorageType:function(){var o;return vtstore.enabled?"vts":(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!!window.indexedDB&&((o=window.indexedDB.open("vtstore",1)).onupgradeneeded=function(e){var t=o.result,t=(object.state.db=t).createObjectStore("vtStoreObj",{keyPath:"id"});object.state.store=t},o.onerror=function(e){object.Helpers.log("DB error","error")},o.onsuccess=function(e){object.state.db=o.result},"db"))},updateCookie:function(e,t){var o=object.Helpers.getCookie(e,!0);o&&(vtlodash.isObject(t)?o.val=vtlodash.merge(o.val,t):o.val=t,object.Helpers.setCookie(e,o.val,o.exp))},setCookie:function(t,o,a){if(t=object.defaults.prefix+t,a=vtlodash.isNumber(a)?a:0,"vts"==object.state.storage)vtstore.set(t,{val:o,exp:a,time:(new Date).getTime()});else if("db"==object.state.storage)try{object.state.db.transaction(["vtStoreObj"],"readwrite").objectStore("vtStoreObj").put({id:t,val:o,exp:a,time:(new Date).getTime()}).onsuccess=function(e){}}catch(e){setTimeout(function(){object.Helpers.setCookie(t.replace(object.defaults.prefix,""),o,a)},50)}var e;t===object.defaults.prefix+object.defaults.cookieNames.uId&&(e=o.userId+"_"+o.sessionId+"_"+o.email+"_"+!!o.push+"_"+!!o.tel+"_"+!!o.isC+"_"+(o.noP||0),object.Helpers.writeCookie(object.defaults.prefix+object.defaults.cookieNames.uId,e,object.defaults.expiration))},getCookie:function(t,o){o=!!o,t=object.defaults.prefix+t;function a(e){return o?e:e?0<e.exp&&(new Date).getTime()-e.time>e.exp?(object.Helpers.removeCookie(t),null):e.val:null}var e;if("vts"==object.state.storage)return e=vtstore.get(t),a(e);if("db"==object.state.storage)try{object.state.db.transaction(["vtStoreObj"],"readwrite").objectStore("vtStoreObj").get(t).onsuccess=function(e){return a(e.target.result)}}catch(e){setTimeout(function(){return object.Helpers.getCookie(t.replace(object.defaults.prefix,""))},50)}},readCookie:function(e){var t=null;try{t=new RegExp(e+"=([^;]+)").exec(document.cookie)}catch(e){object.Helpers.log("Trying to read inexistent cookie","warning")}return null!=t?unescape(t[1]):null},writeCookie:function(e,t,o){try{o=vtlodash.isNumber(o)?((a=new Date).setTime(a.getTime()+o),";expires="+a.toGMTString()):"";var a,s=object.shop.params.cookieDomain||window.location.hostname;document.cookie=e+"="+t+o+";domain=."+s+";path=/"}catch(e){object.Helpers.log("Error trying to set cookie","warning")}},removeCookie:function(t){if(t=object.defaults.prefix+t,"vts"==object.state.storage)vtstore.remove(t);else if("db"==object.state.storage)try{object.state.db.transaction(["vtStoreObj"],"readwrite").objectStore("vtStoreObj").delete(t)}catch(e){setTimeout(function(){object.Helpers.removeCookie(t.replace(object.defaults.prefix,""))},100)}},extractMainURL:function(e){return 0<=e.indexOf("?")?e.substring(0,e.indexOf("?")):e},extractDomain:function(e){return(-1<(e=e||"").indexOf("//")?e.split("/")[2]:e.split("/")[0]).split(":")[0]},makeQueryString:function(e){var t,o=[];for(t in e)e.hasOwnProperty(t)&&o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},addQueryString:function(e,t){return object.Helpers.extractMainURL(e)+"?"+object.Helpers.makeQueryString(vtlodash.merge(object.Helpers.getURLParams(e),t))},getURLParams:function(e){return e.substring(e.indexOf("?")+1).replace(/(^\?)/,"").split("&").map(function(e){return(e=e.split("="))[0]&&!vtlodash.isUndefined(e[1])&&(this[e[0]]=e[1]),this}.bind({}))[0]},browserInfo:function(e){var t,o=navigator.userAgent,a=o.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1])){if(t=/\brv[ :]+(\d+)/g.exec(o)||[],"name"==e)return"explorer";if("version"==e)return t[1]}if("Chrome"===a[1]){if(null!=(t=o.match(/\bOPR\/(\d+)/))&&"name"==e)return"opera";if(null!=t&&"version"==e)return t[1]}return a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=o.match(/version\/(\d+)/i))&&a.splice(1,1,t[1]),"version"==e?a[1]:"name"==e?(a[0]="MSIE"==a[0]?"Explorer":a[0],a[0].toLowerCase()):void 0},browserLang:function(){var e=window.navigator.userLanguage||window.navigator.language;return e&&e.substring(0,e.indexOf("-"))||""},osName:function(){for(var e=[{string:navigator.platform.toLowerCase(),subString:"win",identity:"Windows"},{string:navigator.platform.toLowerCase(),subString:"mac",identity:"Mac"},{string:navigator.userAgent.toLowerCase(),subString:"iphone",identity:"iOS"},{string:navigator.userAgent.toLowerCase(),subString:"android",identity:"Android"},{string:navigator.platform.toLowerCase(),subString:"linux",identity:"Linux"}],t=0;t<e.length;t++){var o=e[t].string;if(o&&-1!=o.indexOf(e[t].subString))return e[t].identity}},inputHasValue:function(e,t){var o,a=!1;switch(e.nodeName){case"INPUT":switch(e.type){case"text":case"url":case"email":case"date":case"number":case"hidden":case"password":case"button":case"reset":case"submit":a=e.value;break;case"checkbox":case"radio":a=(a=t.querySelector('input[name="'+e.name+'"]:checked'))&&a.value}break;case"TEXTAREA":a=e.value;break;case"SELECT":switch(e.type){case"select-one":a=e.value;break;case"select-multiple":for(o=e.options.length-1;0<=o;o-=1)e.options[o].selected&&(a=e.options[o].value)}break;case"BUTTON":switch(e.type){case"reset":case"submit":case"button":a=e.value}}return a=vtlodash.isString(a)?encodeURIComponent(a.trim()):a},isDomNode:function(e){try{return!!e.nodeName}catch(e){return!1}},applyStyle:function(e,t,o){if(e)if(object.Helpers.isDomNode(e))e.style[t]=o;else for(el in e)e.hasOwnProperty(el)&&object.Helpers.isDomNode(e[el])&&(e[el].style[t]=o)},showDom:function(e){object.Helpers.applyStyle(e,"display","block"),object.Helpers.removeClass(e,"vt-hide")},hideDom:function(e){object.Helpers.applyStyle(e,"display","none"),object.Helpers.addClass(e,"vt-hide")},embedTag:function(e,t,o,a){o=o||"body",t=t||"";var s=documentAlias.createElement(e=e||"div");for(el in a)a.hasOwnProperty(el)&&s.setAttribute(el,a[el]);return s.innerHTML=t,vtlodash.isString(o)?documentAlias.getElementsByTagName(o)[0].appendChild(s):object.Helpers.isDomNode(o)&&o.appendChild(s),s},readDataLayer:function(){if(windowAlias&&vtlodash.isArray(windowAlias.dataLayer)&&0<vtlodash.size(windowAlias.dataLayer)){for(var e=windowAlias.dataLayer,t={event:{}},o=0;o<e.length;o++)if(!vtlodash.isObject(e[o])||e[o].event&&0===e[o].event.indexOf("gtm."))vtlodash.isArguments(e[o])&&"event"==e[o][0]&&(t.event[e[o][1]]=t.event[e[o][1]]||[],t.event[e[o][1]].push(e[o][2]));else if(e[o].event)t.event[e[o].event]=t.event[e[o].event]||[],t.event[e[o].event].push(e[o]);else for(var a in e[o])e[o].hasOwnProperty(a)&&(t[a]=t[a]||[],t[a][e[o][a]]=t[a][e[o][a]]||[],t[a][e[o][a]].push(e[o][a]));return t}return null},deviceType:function(){var e=object.Helpers.strtolower(navigator.userAgent||navigator.vendor||window.opera),t="desktop";return e.match(/(ipad|galaxy|xoom|touchpad|t800)/)?t="tablet":(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t="mobile"),t},strtolower:function(e){return null==e&&(e=""),vtlodash.isString(e)?e.toLowerCase():e},getExternalReferrer:function(){return object.Helpers.extractDomain(documentAlias.referrer)==windowAlias.location.hostname?null:documentAlias.referrer},checkAndSubscribe:function(e,t,o,a){var s,n,e=document.querySelector(e);return!(!e||!object.Helpers.emailIsValid(e.value))&&(s=!0,(s=!!(t&&(s=!1,t=document.querySelector(t))&&t.checked)||s)?(t={login:{email:e.value}},n=!1,a&&Object.keys(a).forEach(function(e,t){0===e.indexOf("_ls_")&&(n=!0)}),n||(t.login.isSubscribed=!0),a&&vtlodash.isObject(a)&&(t.login=vtlodash.merge(a,t.login)),o?object.eventApi.pushNext(t):object.state.eventQueue.push(t),!0):void 0)},dateContext:function(){var e={},t=new Date,o=new Date(t.getFullYear(),t.getMonth()+1,0);return e.dayWeek=t.getDay(),e.dayMonth=t.getDate(),e.month=t.getMonth(),e.year=t.getFullYear(),e.lastDayMonth=t.toString().split(e.year)[0]==o.toString().split(e.year)[0],e}},object.Recommender={callBackRecommenderContent:function(data){for(cId in object.Helpers.log("Start inserting content campaigns into page","info"),object.state.waitReccEvent=!1,object.state.contentReccs){var cDom=document.getElementById(object.defaults.idPrefix+cId),newHtml;cDom&&data[cId]&&(!0===object.shop.content.campaigns[cId].siteParams.testMode&&"info"===object.defaults.debug||!object.shop.content.campaigns[cId].siteParams.testMode?(newHtml=object.Campaign.interpolateVars(data[cId]),cDom.innerHTML=newHtml,eval(object.Helpers.extractTagFromHtml(newHtml,"script")),object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.display,cId,object.state.contentReccs[cId]))):object.Helpers.log("Campaign "+cId+" not embeded because of test mode!","error"))}object.Helpers.log("Finished inserting content campaigns into page","info")},callBackRecommenderTwo:function(data){for(var cId in object.Helpers.log("Inserting recommender2 content","info"),data){var cDom,newHtml,newHtml,tpl,tpl;data.hasOwnProperty(cId)&&(cDom=document.getElementById(object.defaults.idPrefix+cId),cDom&&data[cId]&&(vtlodash.isString(data[cId])?newHtml=object.Campaign.interpolateVars(data[cId]):vtlodash.isObject(data[cId])&&(data[cId].loadLibrary&&eval(data[cId].loadLibrary),data[cId].campaign&&("content"==data[cId].campaign.type?object.shop.content.campaigns[cId]=data[cId].campaign:object.shop.campaigns[cId]=data[cId].campaign),newHtml=object.Campaign.interpolateVars(data[cId].html)),cDom.innerHTML=newHtml,eval(object.Helpers.extractTagFromHtml(newHtml,"script"))),object.state.pageCampaigns[cId]&&!0!==object.state.pageCampaigns[cId]?tpl=object.state.pageCampaigns[cId]:cDom&&cDom.getAttribute("data-tpl")&&(tpl=cDom.getAttribute("data-tpl")),tpl)&&object.Campaign.attachClickEvents(cId,tpl,cDom)}object.Helpers.log("Finish inserting recommender2","info")},getData:function(e,t){if("content"==t&&(vtlodash.size(object.state.contentReccs)<1||object.state.calledContentReccs))object.Helpers.log("No recommendations campaigns on page/already called! ","warning");else{var o,a,e={userId:object.User.data.userId,sessionId:object.User.data.sessionId,campaigns:e},s=(object.state.waitReccEvent&&0<=["content"].indexOf(t)&&(a={},s="",object.state.reccEvent&&(object.state.reccEvent.hasOwnProperty("viewitem")&&(object.Helpers.log("Recommender event "+JSON.stringify(object.state.reccEvent),"info"),a.itemId=object.state.reccEvent.viewitem.itemId,s="viewitem"),object.state.reccEvent.hasOwnProperty("addtocart")&&(object.Helpers.log("Recommender event "+JSON.stringify(object.state.reccEvent),"info"),a.itemId=object.state.reccEvent.addtocart.itemId,s="addtocart"),object.state.reccEvent.hasOwnProperty("viewcategory"))&&(object.Helpers.log("Recommender event "+JSON.stringify(object.state.reccEvent),"info"),a.category=object.state.reccEvent.viewcategory.category,s="viewcategory"),e.eventType=s,e.event=a),{data:JSON.stringify(e),callback:object.defaults.reccsCallbackTwo});if("content"==t&&(o=vtlodash.size(object.state.contentReccs)+" campaigns",s.callback=object.defaults.reccsCallbackContent,object.state.calledContentReccs=!0),"preview"==t&&(o="preview "+s.data,s.callback=object.defaults.reccsCallbackTwo,s.returnType="detail"),0!==vtlodash.size(e.campaigns))return a=object.defaults.reccsHost+object.shop.id+"/",a=object.Helpers.addQueryString(a,s),object.Helpers.log("Calling the recommender for "+o,"info"),object.Helpers.getAsync(a),e.campaigns;object.Helpers.log("Trying to request recommender without campaigns ","error")}}},object.Campaign={resetCampaign:function(e){var t={};t[e]=0,object.Helpers.updateCookie(object.defaults.cookieNames.sess,t),object.Helpers.removeCookie(object.defaults.cookieNames.cStatus+e)},extractAttributeFromClass:function(t){var e=new RegExp(object.defaults.siteClasses.attrPrefix+"([^\\s]+)","g");try{return e.lastIndex=0,e.exec(t)[1]}catch(e){object.Helpers.log("Error extracting attribute or from class "+t,"error")}return null},displayCampaign:function(cId,display){var campaign,ret,div,div,runJs,param,newHtml,div_t;return cId&&object.shop.campaigns[cId]?(campaign=object.shop.campaigns[cId],ret={},4==campaign.campaignType?(windowAlias._vtpoll.data=campaign,div=windowAlias._vtpoll.init(!1),documentAlias.getElementsByTagName("body")[0].appendChild(div),ret.tpl=0,object.Campaign.attachClickEvents(cId,ret.tpl,div)):(ret.tpl=object.Helpers.pickRandomPercentages(campaign.templatesPick.params),div=documentAlias.createElement("div"),object.Helpers.hideDom(div),div.setAttribute("id",object.defaults.idPrefix+cId),div.setAttribute("data-tpl",ret.tpl),runJs=!1,!1===campaign.templates[ret.tpl]?(param={},param[cId]=ret.tpl,object.Recommender.getData(param,"interaction")):(newHtml=object.Campaign.interpolateVars(campaign.templates[ret.tpl]),div.innerHTML=newHtml,runJs=!0),documentAlias.getElementsByTagName("body")[0].appendChild(div),runJs&&eval(object.Helpers.extractTagFromHtml(newHtml,"script")),object.Campaign.attachClickEvents(cId,ret.tpl,div),"timeOnPage"!==campaign.siteParams.trigger.mode&&campaign.teasers&&campaign.teasers[ret.tpl]&&(div_t=documentAlias.createElement("div"),div_t.setAttribute("id",object.defaults.idPrefix+cId+"_teaser"),div_t.setAttribute("data-tpl",ret.tpl),div_t.innerHTML=campaign.teasers[ret.tpl],documentAlias.getElementsByTagName("body")[0].appendChild(div_t),object.Helpers.log("Displaying teaser for "+cId,"info"),object.Campaign.attachTeaserClickEvents(cId,div_t,div))),display&&object.Helpers.showDom(div),ret.dom=div,ret):!1},embedCampaign:function(t,e,o){if(!window.vt_stopcampaigns){if(t&&e)return s="body",o&&o.vt_selector&&(s=documentAlias.querySelector(o.vt_selector)),s=object.Helpers.embedTag("div","",s,{id:object.defaults.idPrefix+t,"data-tpl":e}),(o={})[t]=e,object.Recommender.getData(o,"preview"),object.state.pageCampaigns[t]||(object.state.pageCampaigns[t]=e),s;var a,o=object.Helpers.getCookie(object.defaults.cookieNames.cStatus+t),e=((o=vtlodash.isNull(o)?{no:0}:o).stop&&!object.shop.campaigns[t].siteParams.displayCountSession&&"0"==object.shop.campaigns[t].siteParams.afterClose&&delete o.stop,object.User.context.session[t]),s=(vtlodash.isNull(e)&&(e=0),documentAlias.getElementById(object.defaults.idPrefix+t));try{if(object.shop.campaigns[t].siteParams.displayCountSession&&e>=object.shop.campaigns[t].siteParams.displayCountSession&&(object.Helpers.log("Number of displays per session overcome for "+t,"error"),o.stop=!0),!0===object.shop.campaigns[t].siteParams.testMode&&"info"!==object.defaults.debug)object.Helpers.log("Campaign "+t+" not embeded because of test mode!","error");else if(object.Campaign.checkDisplayLimits(t,object.shop.campaigns[t].siteParams)){if(!s)return(o.no<object.shop.campaigns[t].siteParams.displayCount||!object.shop.campaigns[t].siteParams.displayCount)&&!0!==o.stop?(object.Helpers.log("Embeding campaign "+t+" into page","info"),a=object.Campaign.displayCampaign(t,!1),o.tpl=a.tpl,object.Helpers.setCookie(object.defaults.cookieNames.cStatus+t,o),a.dom):void object.Helpers.log("Not allowed to embed campaign "+t,"warning");object.Helpers.log("Campaign element already in page "+t,"warning")}}catch(e){object.Helpers.log("Error trying to embed campaign "+t+". Does not exists or attr missing.","error")}}},checkContentLimits:function(e,t,o){e=e+"_"+o,o=(o=object.User.context.session[e])||0;return o+=1,t.displayCountSession&&o>t.displayCountSession?(object.Helpers.log("Number of displays per session overcome for "+e,"error"),!1):((t=object.User.context&&object.User.context.session||object.Helpers.getCookie(object.defaults.cookieNames.sess))[e]=o,object.Helpers.setCookie(object.defaults.cookieNames.sess,t,object.defaults.sessionDuration),!0)},embedContent:function(cDom,cId,siteParams,tId,groupId){var contentId=cId+"_"+groupId,newHtml;try{return object.Helpers.log("Content "+contentId+" "+tId+" into page","info"),cDom.setAttribute("id",object.defaults.idPrefix+cId),cDom.setAttribute("data-tpl",tId),!1===object.shop.content.templates[tId]?(object.state.contentReccs[cId]=tId,siteParams.eventBound&&(object.Helpers.log("Wait recc event is true","info"),object.state.waitReccEvent=!0)):(newHtml=object.Campaign.interpolateVars(object.shop.content.templates[tId]),cDom.innerHTML=newHtml,eval(object.Helpers.extractTagFromHtml(newHtml,"script")),object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.display,cId,tId))),object.Campaign.attachClickEvents(cId,tId,cDom),cDom}catch(e){return object.Helpers.log("Error trying to embed content "+contentId+". Does not exists or attr missing.","error"),!1}},runDisplayCampaign:function(cId){var campaign=object.shop.campaigns[cId],cStatus=object.Helpers.getCookie(object.defaults.cookieNames.cStatus+cId),cStatusSession=(cStatus.no+=1,cStatus.no===campaign.siteParams.displayCount&&(cStatus.stop=!0),cStatus&&cStatus.stop&&!object.shop.campaigns[cId].siteParams.displayCountSession&&delete cStatus.stop,object.Helpers.setCookie(object.defaults.cookieNames.cStatus+cId,cStatus),vtlodash.isNumber(object.User.context.session[cId])?object.User.context.session[cId]:0),sessContext=(cStatusSession+=1,object.User.context&&object.User.context.session||object.Helpers.getCookie(object.defaults.cookieNames.sess)),cDom;if(sessContext[cId]=cStatusSession,object.Helpers.setCookie(object.defaults.cookieNames.sess,sessContext,object.defaults.sessionDuration),cStatus&&(object.state.pageCampaigns[cId]=!0,object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.display,cId,cStatus.tpl)),object.Helpers.log("Campaign "+cId+" has been displayed","info")),cDom_t=documentAlias.getElementById(object.defaults.idPrefix+cId+"_teaser"),object.Helpers.hideDom(cDom_t),campaign.siteParams.jsDisplay)try{eval(campaign.siteParams.jsDisplay)}catch(e){}campaign.siteParams.autoClose&&0<campaign.siteParams.autoClose&&(cDom=cDom||documentAlias.getElementById(object.defaults.idPrefix+cId),setTimeout(function(){object.Helpers.hideDom(cDom)},1e3*campaign.siteParams.autoClose))},runRegex:function(e,t,o,a){for(var s,n=e;null!==(s=t.exec(e));){var r=s[1],i="";0<s[1].indexOf("|default")&&(r=s[1].substr(0,s[1].indexOf("|")),i=x.substr(x.indexOf("(")+2,x.indexOf(")")-x.indexOf("(")-3)),!(r=object.Helpers.getDeepValue(o,r)||i)&&a||(n=n.replace(s[0],r))}return n},interpolateVars:function(e,t,o){t=t||object.User.context;var a=new RegExp(/\*\*\|([^\s]+?)\|\*\*/g),e=object.Campaign.runRegex(e,a,t,o),a=new RegExp(/\{\{([^\s]+?)\}\}/g);return object.Campaign.runRegex(e,a,t,o)},increaseCountIsValid:function(e,t,o,a){var s=!1;return s="p"===e&&"session.pathname"===t||"e"==e&&vtlodash.isString(t)&&"session.vte."+a.type===t?!0:s},statusObserver:function(e,t){if(object.state.hasUser){if(object.Helpers.log("Starting Onsite campaigns observer "+e,"info"),"v"!==e&&object.shop.params.countConditions&&0<vtlodash.size(object.shop.params.countConditions)){object.Helpers.log("Increasing counts for display rules conditions","info");for(var o=(o=object.Helpers.getCookie(object.defaults.cookieNames.condCount))||{},a=0;a<vtlodash.size(object.shop.params.countConditions);a++){cond=object.shop.params.countConditions[a],condKey=object.shop.params.countConditionsKeys[cond.key+cond.op+cond.val];var s=object.Helpers.getContextValue(cond.key,e,t);object.Helpers.valuesComparer(s,cond.val,cond.op)&&object.Campaign.increaseCountIsValid(e,cond.key,s,t)&&(o[condKey]=o[condKey]||0,o[condKey]+=1)}object.Helpers.setCookie(object.defaults.cookieNames.condCount,o)}if(0<vtlodash.size(object.shop.campaigns)){for(cId in object.state.campaignsOK=[],object.state.campaignsBackendOK=[],object.shop.campaigns){var n,r,i=object.Helpers.getCookie(object.defaults.cookieNames.cStatus+cId);i&&i.stop&&!object.shop.campaigns[cId].siteParams.displayCountSession&&delete i.stop,object.shop.campaigns.hasOwnProperty(cId)&&(i&&!0!==i.stop||vtlodash.isNull(i))&&(i=!1,(c=object.shop.campaigns[cId]).siteParams.displayRulesOR&&0<c.siteParams.displayRulesOR.length&&(i=!0),c.siteParams.oroperator=c.siteParams.oroperator||"or",n=!1,object.Campaign.checkDisplayRules(c.siteParams.displayRules,!1)?(r=object.Campaign.checkDisplayRules(c.siteParams.displayRulesOR,!0),(!i||r&&"and"==c.siteParams.oroperator)&&(n=!0)):(r=object.Campaign.checkDisplayRules(c.siteParams.displayRulesOR,!0),i&&r&&"or"==c.siteParams.oroperator&&(n=!0)),n)&&(c.siteParams.backend?object.state.campaignsBackendOK:object.state.campaignsOK).push(cId)}if(object.tasks.addReadyListener(object.Campaign.triggerCampaigns,"trigc"),vtlodash.size(object.state.campaignsBackendOK)){var l={callback:object.defaults.backendCallback,userId:object.User.data.userId,campaigns:object.state.campaignsBackendOK},l=object.Helpers.addQueryString(object.defaults.backendHost+object.shop.id,l);if(object.state.botagent)return;object.Helpers.getAsync(l)}}object.Helpers.log("Ending Onsite campaigns observer "+e,"info")}else object.Helpers.log("No user, onsite campaigns delayed for "+e,"info"),setTimeout(function(){object.Campaign.statusObserver(e,t)},1e3)},triggerCampaigns:function(e){if(e=e||object.state.campaignsOK,0<vtlodash.size(e)){object.Helpers.log("Triggering campaigns that match display rules","info");for(var t,o=[],a=!1,s=0;s<vtlodash.size(e);s++)cId=e[s],object.shop.campaigns[cId]&&((t=object.shop.campaigns[cId]).siteParams.priority?vtlodash.isNumber(t.siteParams.priority)&&(a&&t.siteParams.priority>object.shop.campaigns[a].siteParams.priority||!a)&&(a=cId):o.push(cId));object.Helpers.log("No priority campaigns in "+o.length+". Max priority "+a,"info"),a&&(object.Campaign.triggerOne(a,object.shop.campaigns[a]),0<=o.indexOf(a))&&o.splice(o.indexOf(a),1);for(s=0;s<o.length;s++)object.Campaign.triggerOne(o[s],object.shop.campaigns[o[s]])}},triggerOne:function(d,o){var a;d&&(!o&&object.shop.campaigns[d]&&(o=object.shop.campaigns[d]),object.Helpers.log("Campaign "+d+" ready to be triggered: "+o.siteParams.trigger.mode,"info"),(a={timeOnPage:function(e,t){object.Helpers.log("Trigger "+d+" after "+t.delay+" seconds","info");t=vtlodash.isNumber(t.delay)&&1e3*t.delay||0;setTimeout(function(){(!object.shop.campaigns[d].siteParams.single||object.shop.campaigns[d].siteParams.single&&!object.state.singleFlag)&&(object.Helpers.showDom(e),object.Campaign.runDisplayCampaign(d),object.shop.campaigns[d].siteParams.single)&&(object.state.singleFlag=!0)},t)},onClose:function(e,t){object.Helpers.log("Trigger "+d+" on page unload ","info"),windowAlias.onbeforeunload=function(){return object.Helpers.showDom(e),object.Campaign.runDisplayCampaign(d),"?"}},onInactivity:function(e,t){object.state.inactivityCampaigns.push(d)}}).onExit=function(e,t){var a,s={sensitivity:t.sensitivity||20,timer:t.timer||1,delay:t.delay||0,cancelDelay:t.cancelDelay||!1,corner:t.corner||"any",cornerWidth:t.cornerWidth||50},o=document.documentElement,n=!1;function r(e){var t,o;e.clientY>s.sensitivity||(o=(t=Math.max(document.documentElement.clientWidth,window.innerWidth||0))*s.cornerWidth/100,"input"==e.target.tagName.toLowerCase())||"left"==s.corner&&e.clientX>o||"right"==s.corner&&e.clientX<t-o||"any"==s.corner&&e.clientX>o&&e.clientX<t-o||e.clientX>=t-50||(a=setTimeout(l,1e3*s.delay))}function i(){a&&s.cancelDelay&&(clearTimeout(a),a=null)}function c(e){n||e.metaKey&&76===e.keyCode&&(n=!0,a=setTimeout(l,s.delay))}function l(){object.Helpers.showDom(e),object.shop.campaigns[d].siteParams.single&&object.state.singleFlag?object.Helpers.hideDom(e):(object.Campaign.runDisplayCampaign(d),object.shop.campaigns[d].siteParams.single&&(object.state.singleFlag=!0)),o.removeEventListener("mouseleave",r),o.removeEventListener("mouseenter",i),o.removeEventListener("keydown",c),a&&clearTimeout(a)}"os"==s.corner&&(s.corner="left",0<=["Windows"].indexOf(object.User.context.session.osname))&&(s.corner="right"),setTimeout(function(){object.Helpers.addEventListener(o,"mouseleave",r),object.Helpers.addEventListener(o,"mouseenter",i),object.Helpers.addEventListener(o,"keydown",c)},1e3*s.timer),object.Helpers.log("Trigger "+d+" on exit intent","info")},a.onClick=function(t,e){if(e.selector){var o=documentAlias.querySelectorAll(e.selector);for(el in o)o.hasOwnProperty(el)&&object.Helpers.addEventListener(o[el],"click",function(e){e.preventDefault(),object.Helpers.showDom(t),object.state.pageCampaigns[d]||(!object.shop.campaigns[d].siteParams.single||object.shop.campaigns[d].siteParams.single&&!object.state.singleFlag)&&(object.Campaign.runDisplayCampaign(d),object.shop.campaigns[d].siteParams.single)&&(object.state.singleFlag=!0)},!1);object.Helpers.log("Trigger "+d+" on click elements "+e.selector,"info")}},a.onScroll=function(s,n){n.percent=vtlodash.isNumber(n.percent)?n.percent:25;object.Helpers.addEventListener(windowAlias,"scroll",function(e){var t=s,o=n.percent;try{var a=100*((document.documentElement.scrollTop+document.body.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)||0)}catch(e){a=0}o<=a&&!object.state.pageCampaigns[d]&&(!object.shop.campaigns[d].siteParams.single||object.shop.campaigns[d].siteParams.single&&!object.state.singleFlag)&&(object.Helpers.showDom(t),object.Campaign.runDisplayCampaign(d),object.shop.campaigns[d].siteParams.single)&&(object.state.singleFlag=!0)}),object.Helpers.log("Trigger "+d+" on % scroll ","info")},a.onLeave=function(e,t){var o;object.state.leaveCp=object.state.leaveCp||[],object.state.leaveCp.push(d),1==object.state.leaveCp.length&&history.replaceState&&(o=!1,object.Helpers.getExternalReferrer()?(object.state.exit_vtp=history.length-1,_vtsdk.User.context.session.exit_vtp=object.state.exit_vtp,object.Helpers.updateCookie(object.defaults.cookieNames.sess,{exit_vtp:object.state.exit_vtp}),o=!0):history.state&&history.state.vtp&&object.User.context.session.exit_vtp===history.state.vtp&&(object.state.exit_vtp=object.User.context.session.exit_vtp,o=!0),o)&&(object.Helpers.log("onLeave trigger is valid.","info"),history.replaceState({vtp:object.state.exit_vtp,href:location.href},""),history.pushState({vtp:object.state.exit_vtp+1,href:location.href},""),object.Helpers.addEventListener(windowAlias,"popstate",function(e){if(history.state&&history.state.vtp==object.state.exit_vtp)for(var t=0;t<object.state.leaveCp.length;t++){object.state.leaveCp[t];var o=documentAlias.getElementById(object.defaults.idPrefix+d);object.Helpers.showDom(o),object.Campaign.runDisplayCampaign(d)}}))},setTimeout(function(){if(0<=["complete","loaded","interactive"].indexOf(document.readyState)){var e=object.Campaign.embedCampaign(d),t=vtlodash.isNull(o.siteParams.trigger.params)?null:o.siteParams.trigger.params;if(e)return object.Helpers.log("Attaching trigger "+o.siteParams.trigger.mode+" for: "+d,"info"),a[o.siteParams.trigger.mode](e,t)}else object.Helpers.log("Document ready state: "+document.readyState+" for: "+d,"debug")},10))},triggerInactivityCampaigns:function(e){if(e+=2,object.state.inactivityCampaigns&&object.shop.params.hasActTriggers)for(var t,o=object.state.inactivityCampaigns.length-1;0<=o;o--){var a=object.state.inactivityCampaigns[o];!object.state.pageCampaigns[a]&&object.shop.campaigns[a].siteParams.trigger.params.delay<=e&&(object.Helpers.log("Valid inactivity campaign "+a,"info"),!object.shop.campaigns[a].siteParams.single||object.shop.campaigns[a].siteParams.single&&!object.state.singleFlag)&&(t=documentAlias.getElementById(object.defaults.idPrefix+a),object.Helpers.showDom(t),object.Campaign.runDisplayCampaign(a),object.shop.campaigns[a].siteParams.single)&&(object.state.singleFlag=!0)}},buildAttrObject:function(e,t){for(var o,a,s={},n=0;n<e.length;n++)try{(o=object.Campaign.extractAttributeFromClass(e[n].className))&&(t||-1==e[n].className.indexOf(object.defaults.siteClasses.submit))&&null!==(a=e[n]=e[n].value||null)&&""!==a&&(["radio","checkbox"].indexOf(e[n].type)<0||!0===e[n].checked)&&("tags"==o?(s[o]=s[o]||[],s[o].push(a)):s[o]=a)}catch(e){object.Helpers.log("Error getting attribute type and value from campaign inputs","error")}return s},createSiteEvent:function(e,t,o,a){var s={};if(e){a=a&&JSON.parse(JSON.stringify(a));var n=object.shop.campaigns[t]?object.shop.campaigns[t].campaignType:null;if(vtlodash.isNull(n)&&(n=null,vtlodash.isNull(n)&&(n=null==n&&object.shop.params.hasRunningContent&&object.shop.content.campaigns[t]?object.shop.content.campaigns[t].campaignType:null),vtlodash.isNull(n))&&(n=null==n&&object.shop.params.hasRunningAds&&object.shop.adserver&&object.shop.adserver.campaigns&&object.shop.adserver.campaigns[t]?object.shop.adserver.campaigns[t].campaignType:null),a&&a.campaignType&&(n=a.campaignType),!t||!o)return!1;s[e]={tracking:{vt_campaign:t,vt_content:o,campaignType:n=null===n?0:n}},a&&a.generic&&a.generic.tags&&(a.tags=a.generic.tags,delete a.generic.tags),vtlodash.isObject(a)&&(s[e]=vtlodash.merge(s[e],a))}return s},attachTeaserClickEvents:function(t,o,a){object.Helpers.addEventListener(o,"click",function(e){e.preventDefault(),0<=[e.target.className,e.target.parentElement.className].indexOf(object.defaults.siteClasses.close)?object.Helpers.hideDom(o):(object.Helpers.showDom(a),object.Campaign.runDisplayCampaign(t))},!1)},attachClickEvents:function(cId,tpl,cDom){var cDomDom=cDom;if(cDomDom&&cDomDom.innerHTML&&""===cDomDom.innerHTML.trim())object.Helpers.log("Empty tag, so we won't attach click events","error");else{var elem,toggle_fct=(object.Helpers.log("Attaching click events campaign: "+cId,"info"),function(e,t,o){try{if(o=o||documentAlias.getElementById(object.defaults.idPrefix+e)){var a,s=o.getElementsByClassName(t);for(a in s)s.hasOwnProperty(a)&&(s[a].style.display="none"==s[a].style.display?"block":"none")}}catch(e){console.log(e)}}),elem=cDom.querySelectorAll("[vtw-toggle]");for(el in elem)elem.hasOwnProperty(el)&&object.Helpers.addEventListener(elem[el],"click",function(e){return e.preventDefault(),object.Helpers.log("Toggle event attached to "+el+" element for "+cId,"info"),toggle_fct(cId,elem[el].getAttribute("vtw-toggle"),cDomDom)},!1);var click_fct=function(e,t,o){(object.shop.campaigns[e]||object.shop.content.campaigns[e]||!1)&&(object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.click,e,t)),object.Helpers.setAnalyticsSource(e,"interaction"),t=o.getAttribute("href"))&&"#"!=t[0]&&("_blank"==o.getAttribute("target")?window.open(t):window.location=t)};for(el in elem=cDom.getElementsByClassName(object.defaults.siteClasses.click),elem)elem.hasOwnProperty(el)&&object.Helpers.addEventListener(elem[el],"click",function(e){return"a"==elem[el].tagName.toLowerCase()&&e.preventDefault(),"body"==documentAlias.getElementById(object.defaults.idPrefix+cId).parentNode.tagName.toLowerCase()&&e.stopPropagation(),object.Helpers.log("Click event attached to "+el+" element for "+cId,"info"),click_fct(cId,tpl,e.currentTarget)},!1);var close_fct=function(cId,tpl,cDom){var cDom=cDom||documentAlias.getElementById(object.defaults.idPrefix+cId),cObject=object.shop.campaigns[cId]||object.shop.content.campaigns[cId]||!1;if(cDom&&(object.Helpers.hideDom(cDom),cObject)){if("0"!=cObject.siteParams.afterClose&&(cStatus=object.Helpers.getCookie(object.defaults.cookieNames.cStatus+cId),cStatus.stop=!0,object.Helpers.setCookie(object.defaults.cookieNames.cStatus+cId,cStatus,object.defaults.dayDuration*parseInt(cObject.siteParams.afterClose)),object.Helpers.log("Campaign "+cId+" not displayed for "+cObject.siteParams.afterClose+"days !","info")),cObject.siteParams.jsClose)try{eval(cObject.siteParams.jsClose)}catch(e){}cDom&&0<=cDom.className.indexOf(object.defaults.siteClasses.click)?(object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.click,cId,tpl)),object.Helpers.setAnalyticsSource(cId,"interaction")):object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.close,cId,tpl))}};for(el in elem=cDom.getElementsByClassName(object.defaults.siteClasses.close),elem)elem.hasOwnProperty(el)&&object.Helpers.addEventListener(elem[el],"click",function(e){e.preventDefault(),e.stopPropagation();try{if(0<=e.currentTarget.className.indexOf(object.defaults.siteClasses.overlay)&&e.target!==e.currentTarget)return!1}catch(e){}return object.Helpers.log("Close event attached to "+el+" element for "+cId,"info"),close_fct(cId,tpl,cDomDom)},!1);var submit_fct=function(target,cId,tpl,cDom){var cDom=cDom||documentAlias.getElementById(object.defaults.idPrefix+cId),cObject=object.shop.campaigns[cId]||object.shop.content.campaigns[cId]||!1;if(cDom){for(var reqOK=!0,invalidOK=!0,req=cDom.querySelectorAll("[required]"),class2Add="",i=0;i<req.length;i++){class2Add="",object.Helpers.inputHasValue(req[i],cDom)||(reqOK=!1,class2Add=" "+object.defaults.siteClasses.required);try{req[i].className=req[i].className.split(object.defaults.siteClasses.required).join("")+class2Add,req[i].parentNode&&(req[i].parentNode.className=req[i].parentNode.className.split(object.defaults.siteClasses.required).join("")+class2Add)}catch(e){}try{class2Add="",req[i].validity.valid||(class2Add=" "+object.defaults.siteClasses.invalid,req[i].className=req[i].className.split(object.defaults.siteClasses.invalid).join("")+class2Add,invalidOK=!1),req[i].parentNode&&(req[i].parentNode.className=req[i].parentNode.className.split(object.defaults.siteClasses.invalid).join("")+class2Add)}catch(e){}}if(reqOK)if(invalidOK){var elem=cDom.getElementsByClassName(object.defaults.siteClasses.attr),params=object.Campaign.buildAttrObject(elem,!1),submit_attr=object.Campaign.extractAttributeFromClass(target.className),next,current,cStatus;if(submit_attr&&target.value&&(params[submit_attr]=target.value),submitOK=!1,params.email&&object.Helpers.emailIsValid(params.email))params.email=object.Helpers.cleanEmail(params.email),object.shop.campaigns[cId]&&object.shop.campaigns[cId].tpl_data[tpl]&&(params=vtlodash.merge(params,object.shop.campaigns[cId].tpl_data[tpl])),params.generic={campaign:cId,content:tpl},object.state.eventQueue&&object.state.eventQueue.push({login:params}),submitOK=!0,object.Helpers.setAnalyticsSource(cId,"interaction"),delete params.generic;else if(params.email&&!object.Helpers.emailIsValid(params.email))return object.Helpers.showDom(cDom.getElementsByClassName(object.defaults.siteClasses.error)),void(cDom.className=cDom.className.split(object.defaults.siteClasses.invalid).join("")+" "+object.defaults.siteClasses.invalid);params.hasOwnProperty("email")&&!submitOK||(object.state.eventQueue&&object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.submit,cId,tpl,{generic:params})),object.Helpers.setAnalyticsSource(cId,"interaction"),next=target.getAttribute("nextstate"),current=target.getAttribute("currentstate"),next&&current&&(next=0===next.indexOf(object.defaults.siteClasses.classPrefix)?next:object.defaults.siteClasses.classPrefix+next,current=0===current.indexOf(object.defaults.siteClasses.classPrefix)?current:object.defaults.siteClasses.classPrefix+current,object.Helpers.showDom(cDom.getElementsByClassName(next)),object.Helpers.hideDom(cDom.getElementsByClassName(current))),object.Helpers.hideDom(cDom.getElementsByClassName(object.defaults.siteClasses.error)),cObject&&cObject.siteParams.afterSubmit&&("close"===cObject.siteParams.afterSubmit?setTimeout(function(){object.Helpers.hideDom(cDom)},2e3):0<parseInt(cObject.siteParams.afterSubmit)&&(cStatus=object.Helpers.getCookie(object.defaults.cookieNames.cStatus+cId),vtlodash.isNull(cStatus)&&(cStatus={no:1}),cStatus.stop=!0,object.Helpers.setCookie(object.defaults.cookieNames.cStatus+cId,cStatus,object.defaults.dayDuration*parseInt(cObject.siteParams.afterSubmit)),object.Helpers.log("Campaign "+cId+" not displayed for "+cObject.siteParams.afterSubmit+"days !","info"))));try{window.gtag("event","page_view",{page_location:"/submit?vt_campaign="+cId+"&vt_content="+tpl,category:object.shop.ganalytics.category})}catch(e){}var onsubmit=target.getAttribute("onsubmit"),url,url;if(onsubmit)try{eval(onsubmit)}catch(e){}if(cObject){if(cObject.siteParams.jsSubmit)try{eval(cObject.siteParams.jsSubmit)}catch(e){}cObject.siteParams.callEndpoint&&(url=object.Campaign.interpolateVars(cObject.siteParams.callEndpoint,params,!0),url=object.Campaign.interpolateVars(url,object.shop,!0),url=object.Campaign.interpolateVars(url),object.Helpers.getAsync(url))}}else cDom.className=cDom.className.split(object.defaults.siteClasses.invalid).join("")+" "+object.defaults.siteClasses.invalid,object.Helpers.showDom(cDom.getElementsByClassName(object.defaults.siteClasses.error));else cDom.className=cDom.className.split(object.defaults.siteClasses.required).join("")+" "+object.defaults.siteClasses.required,object.Helpers.showDom(cDom.getElementsByClassName(object.defaults.siteClasses.error))}};for(el in elem=cDom.getElementsByClassName(object.defaults.siteClasses.submit),elem)elem.hasOwnProperty(el)&&object.Helpers.addEventListener(elem[el],"click",function(e){return e.preventDefault(),e.stopPropagation(),object.Helpers.log("Submit event attached to "+el+" element for "+cId,"info"),submit_fct(e.currentTarget,cId,tpl,cDomDom)},!1)}},checkDisplayRules:function(e,t){for(var o=vtlodash.size(e),a=t?!1:!0,s=object.Helpers.getCookie(object.defaults.cookieNames.condCount),n=0;n<o;n++){var r=e[n],i=object.Helpers.getContextValue(r.key),i=object.Helpers.valuesComparer(i,r.val,r.op);try{contextCountVal=s[object.shop.params.countConditionsKeys[r.key+r.op+r.val]]}catch(e){contextCountVal=null}if(i&&r.hasOwnProperty("count")&&null!=contextCountVal&&(i=object.Helpers.valuesComparer(contextCountVal,r.count.val,r.count.op)),!t&&!i)return!1;if(t&&i)return!0}return a},checkDisplayLimits:function(e,t){var o;return!(!vtlodash.isObject(t)||((o=object.Helpers.getCookie(object.defaults.cookieNames.capping+e))&&(t.dulimit&&o.dulimit>=t.dulimit||t.dlimit&&o.dlimit>=t.dlimit||t.mlimit&&o.mlimit>=t.mlimit)?(object.Helpers.log("Capping exceeded for "+e,"warning"),1):(t.start&&t.startDate>object.defaults.nowTime||t.end&&t.endDate<object.defaults.nowTime)&&(object.Helpers.log("Time limits exceeded for "+e,"warning"),1)))},returnContentEmbedLocation:function(e,t=!0){var o=null,a="body",s=null;return e?(s=documentAlias.querySelector(e),object.Helpers.isDomNode(s)&&(a="selector",o=documentAlias.createElement("div"))):t&&(o=documentAlias.createElement("div")),[o,a,s]},embedContentWrapper:function(e,t,o,a){if("selector"==t)switch(e){case"append":o.appendChild(a);break;case"prepend":o.insertBefore(a,o.firstChild);break;case"after":o.parentNode.insertBefore(a,o.nextSibling);break;case"before":o.parentNode.insertBefore(a,o);break;default:o.innerHTML="",o.appendChild(a)}else documentAlias.body.appendChild(a)},processSingleContent:function(e,t,o,a=!1){if(o=o||{},"number"!=typeof e||(e=_vtsdk.shop.content.campaigns[e])){if("single"==e.siteParams.locations){var s=object.Campaign.returnContentEmbedLocation(e.siteParams.selector,!0);if(cDom=s[0],object.Helpers.isDomNode(cDom)){var n=object.Helpers.pickRandomPercentages(e.content[t].templatesPick);if(object.Campaign.embedContentWrapper(e.siteParams.embedType,s[1],s[2],cDom),!a&&!object.Campaign.checkContentLimits(e.id,e.siteParams[e.content[t].id],e.content[t].id))return void object.Helpers.log("Group "+t+" embeded issue "+e.id,"error");object.Campaign.embedContent(cDom,e.id,e.siteParams[e.content[t].id],n,e.content[t].id),object.Helpers.log("Group "+t+" embeded for campaign "+e.id,"info"),o[e.id]=e.content[t].id}}else if("multi"==e.siteParams.locations){if(!a&&!object.Campaign.checkContentLimits(e.id,e.siteParams[e.content[t].id],e.content[t].id))return void object.Helpers.log("Group "+t+" embeded issue "+e.id,"error");for(var r=e.content[t].templates.length-1;0<=r;r--){var i=e.content[t].templates[r],s=object.Campaign.returnContentEmbedLocation(e.content[t].selector[i],!0);object.Helpers.isDomNode(s[0])&&(object.Campaign.embedContentWrapper(e.content[t].embedType[i],s[1],s[2],s[0]),object.Campaign.embedContent(s[0],e.id,e.siteParams[e.content[t].id],i,e.content[t].id),object.Helpers.log("Group "+t+" embeded for campaign "+e.id,"info"),o[e.id]=e.content[t].id)}}return o}},processContentCampaigns:function(){if(!1!==object.shop.params.hasRunningContent&&!0!==object.state.calledContent){object.state.contentReccs=object.state.contentReccs||{},object.state.waitReccEvent=!1,object.Helpers.log("Started content campaigns!","info");var e={};for(cId in object.shop.content.campaigns)if(object.shop.content.campaigns.hasOwnProperty(cId)&&object.Campaign.checkDisplayLimits(cId,object.shop.content.campaigns[cId].siteParams)){var t=object.shop.content.campaigns[cId];if(!t.siteParams.testMode||!0===t.siteParams.testMode&&"info"===object.defaults.debug){object.Helpers.log("Embedding content "+(t.siteParams.selector||"page")+" for "+cId,"info");for(var o=vtlodash.size(t.content),a=0;a<o;a++){var s,n=t.content[a].displayRulesOR&&0<t.content[a].displayRulesOR.length,r=(t.content[a].oroperator=t.content[a].oroperator||"or",!1);object.Campaign.checkDisplayRules(t.content[a].displayRules,!1)?(s=object.Campaign.checkDisplayRules(t.content[a].displayRulesOR,!0),(!n||s&&"and"==t.content[a].oroperator)&&(r=!0)):(s=object.Campaign.checkDisplayRules(t.content[a].displayRulesOR,!0),n&&s&&"or"==t.content[a].oroperator&&(r=!0)),t.content[a].checkBackend&&object.state.backendContent[t.id]&&!object.state.backendContent[t.id][t.content[a].id]?object.Helpers.log("Group "+a+" backend invalid "+cId,"error"):r?e=object.Campaign.processSingleContent(t,a,e):object.Helpers.log("Group "+a+" not matching conditions "+cId,"info")}}else object.Helpers.log("Campaign "+cId+" not embeded. Test mode or no element!","error")}return object.state.calledContent=!0,(object.state.waitReccEvent&&vtlodash.isObject(object.state.reccEvent)||!1===object.state.waitReccEvent)&&(object.Helpers.log("Recc Event is already here!","warning"),object.Recommender.getData(object.state.contentReccs,"content")),e}},cacheBackendCheck:function(e){if(!e&&object.shop.content.backendContent&&object.shop.content.backendContent.length&&(object.state.backendContent=object.Helpers.getCookie(object.defaults.cookieNames.backendCache),!object.state.backendContent)&&!object.state.reqBackendCheck){var t={callback:object.defaults.cacheBackendCheck,userId:object.User.data.userId,campaigns:object.shop.content.backendContent},t=object.Helpers.addQueryString(object.defaults.backendHost+object.shop.id,t);if(object.state.botagent)return;object.Helpers.getAsync(t),object.state.reqBackendCheck=!0}e&&(object.Helpers.setCookie(object.defaults.cookieNames.backendCache,e,18e5),object.state.backendContent=e)}},object.queueManager={eventsObserver:function(){if(object.state.hasUser)if(object.state.waitUserRequest)object.Helpers.log("Requesting user!","error");else{var e=object.state.eventQueue.shift();if(e)if(object.defaults.stopevents)object.Helpers.log("Events are stopped!","error");else{object.state.pageQueue.push(e);var t=object.eventApi.convertEventObject(e);if((e.viewitem||e.viewcategory||e.addtocart)&&object.eventApi.validateEvent(t)&&(object.Helpers.log("Store possible recc event!","info"),object.state.reccEvent=e),e.login&&object.eventApi.validateEvent(t)&&object.state.loginHash!=object.eventApi.hashEvent(t))e.login.email?(e.login.email=object.Helpers.cleanEmail(e.login.email),object.User.changeUserByEmail(e.login.email)):e.login.uuid&&object.User.changeUserByUuid(e.login.uuid),object.state.loginToPush=e,object.state.loginHash=object.eventApi.hashEvent(t);else{if(!vtlodash.isArray(e))return 1<=vtlodash.size(object.state.contentReccs)&&object.state.waitReccEvent&&object.state.reccEvent&&object.Recommender.getData(object.state.contentReccs,"content"),"login"==e.type&&(e.generic=e.generic||{},e.generic.sec=Math.round(((new Date).getTime()-object.defaults.nowTimeLocal)/1e3)),object.eventApi.sendEvent(e)&&object.tasks.createVisitorContext("e",e),object.Campaign.statusObserver("e",t),e;"setVar"===e[0]&&(object.setVar(e[1],e[2]),object.Campaign.statusObserver("v"))}}}else object.Helpers.log("No local user, exiting!","error")}},object.tasks={runShopJS:function(){if(object.shop.params.customJS&&!object.state.runCustomJS){object.state.runCustomJS=!0;try{eval(object.shop.params.customJS)}catch(e){object.Helpers.log("Error running custom JS for shop "+e.message,"error")}}},followDataLayer:function(){var e=object.Helpers.readDataLayer();e&&(object.User.context.vars=object.User.context.vars||{},object.User.context.vars.dataLayer=e)},requestWebID:function(e){var t;e=e||object.shop.params.webidTags.join(","),object.shop.params.getVisitorWebid&&windowAlias._vtwebid&&e&&(!(t=object.Helpers.getCookie(object.defaults.cookieNames.webid))&&e?(e=windowAlias._vtwebid.return_tags_url(object.shop.id,e,""),vtlodash.request(e,function(e){vtlodash.isString(e)&&(e=JSON.parse(e)),vtlodash.isObject(e)&&(object.Helpers.setCookie(object.defaults.cookieNames.webid,e,object.defaults.shortDuration),object.User.context.webid=e)})):vtlodash.isObject(t)&&(object.User.context.webid=t))},checkUserIdentity:function(){object.Helpers.log("Checking user identity from URL params","info");for(var e=object.defaults.userIndentityParams.length-1;0<=e;e--){var t,o=object.defaults.userIndentityParams[e];if(object.User.context.session.urlparams.hasOwnProperty(o))return t=object.User.context.session.urlparams[o],"vt_user"==o&&t.length==object.defaults.userKeyLength?object.User.changeUserById(t):object.Helpers.emailIsValid(t)&&object.User.changeUserByEmail(t),!0}return!1},createUserContext:function(e){object.Helpers.log("Creating User context","info");var t=object.User.getLocalUser();t?(object.User.data=t,object.state.hasUser=!0):e||object.User.requestUser()},createVisitorContext:function(trigger,vtevent){object.Helpers.log("Creating visitor context for "+trigger,"info");var allContext=object.User.context&&object.User.context.all||object.Helpers.getCookie(object.defaults.cookieNames.all),sessContext=object.User.context&&object.User.context.session||object.Helpers.getCookie(object.defaults.cookieNames.sess),allChanged=sessChanged=!1,session_is_new=(vtevent=vtevent||null,trigger=trigger||"p",null==allContext&&(allContext={noVisits:0,firstVisit:object.defaults.nowTime,lastVisit:object.defaults.nowTime},allChanged=!0),!1);if("p"==trigger){var urlparams=object.Helpers.getURLParams(windowAlias.location.search),currentUTM={utm_source:null,utm_term:null,utm_campaign:null,utm_content:null,utm_medium:null},newReferrer=(null!=sessContext&&(currentUTM=vtlodash.overwrite(currentUTM,sessContext)),currentUTM=vtlodash.overwrite(currentUTM,urlparams),null==sessContext&&(sessContext={pathname:"",landing:windowAlias.location.pathname,noPageViews:0,firstVisit:object.defaults.nowTime,city:"",country:""},sessChanged=!0,allContext.noVisits+=1,allContext.lastVisit=sessContext.firstVisit,allChanged=!0,session_is_new=!0),object.Helpers.getExternalReferrer()),params,i;for(i in(newReferrer||urlparams.utm_campaign)&&(sessContext.lastReferrer=newReferrer,newReferrer!=allContext.lastReferrer&&(allContext.lastReferrer=newReferrer,allChanged=!0),object.shop.params.referer)&&(params={domain:object.Helpers.extractDomain(newReferrer),url:newReferrer},newReferrer&&(params.generic={url:newReferrer}),params=vtlodash.merge(params,currentUTM),object.state.eventQueue.push({referer:params})),currentUTM)currentUTM.hasOwnProperty(i)&&delete urlparams[i];sessContext.urlparams=urlparams,sessContext=vtlodash.merge(sessContext,currentUTM),sessContext.timeOnSite=Math.round((object.defaults.nowTime-sessContext.firstVisit)/1e3/60);var current={pathname:windowAlias.location.pathname+windowAlias.location.search+windowAlias.location.hash,homepage:"/"==windowAlias.location.pathname,title:documentAlias.title,hostname:windowAlias.location.hostname,urlparams:urlparams,osname:object.Helpers.osName(),browser:object.Helpers.browserInfo("name"),browserVersion:object.Helpers.browserInfo("version"),lang:object.Helpers.browserLang(),deviceType:object.Helpers.deviceType(),vt_campaign:urlparams.vt_campaign||null,vt_content:urlparams.vt_content||null,noPageViews:sessContext.noPageViews+=1},fs,db;if(urlparams.vt_campaign&&urlparams.vt_content&&(current.vt_click=urlparams.vt_campaign+"_"+urlparams.vt_content),object.shop.push&&object.shop.push.enabled&&(current.pushValid=!0,"chrome"==current.browser?(current.pushValid=!0,fs=window.RequestFileSystem||window.webkitRequestFileSystem,fs&&fs(window.TEMPORARY,100,function(){object.User.context.session.private=!1},function(){object.User.context.session.private=!0,object.User.context.session.pushValid=!1})):"firefox"==current.browser&&(current.pushValid=!0,db=indexedDB.open("test"),db.onerror=function(){object.User.context.session.private=!0,object.User.context.session.pushValid=!1},db.onsuccess=function(){object.User.context.session.private=!1})),sessContext=vtlodash.merge(sessContext,current),object.shop.push&&object.shop.push.enabled&&object.webpush&&!object.state.webpush&&(object.state.webpush=!0),object.shop.params.pageJS&&!object.state.runPageJS){object.state.runPageJS=!0,vtlodash.isArray(object.shop.params.pageJS)||(object.shop.params.pageJS=[object.shop.params.pageJS]);for(var i=0;i<object.shop.params.pageJS.length;i++)try{eval(object.shop.params.pageJS[i])}catch(e){object.Helpers.log("Error running pageJS "+i+": "+e.message,"error")}}}else if("e"==trigger){var current={};switch(vtevent=object.eventApi.convertEventObject(vtevent),sessChanged=!0,sessContext.vte=sessContext.vte||{},sessContext.vte[vtevent.type]=sessContext.vte[vtevent.type]?sessContext.vte[vtevent.type]+1:1,vtevent.type){case"viewitem":object.setVar("pageType","product");break;case"viewcategory":object.setVar("pageType","category");break;case"confirmation":object.setVar("pageType","confirmation"),allContext.isCustomer=!0,allChanged=!0,allContext.lastPurchaseDays=object.defaults.nowTime,allContext.firstPurchaseDays=allContext.firstPurchaseDays||object.defaults.nowTime,object.eventApi.pushNext("requser");break;case"addtocart":sessContext.lastaddcart=object.defaults.nowTime;break;case"search":object.setVar("pageType","search");break;case"addtowishlist":break;case"checkout":object.setVar("pageType","checkout")}}if(allChanged&&object.Helpers.setCookie(object.defaults.cookieNames.all,allContext),sessChanged&&object.Helpers.setCookie(object.defaults.cookieNames.sess,sessContext,object.defaults.sessionDuration),sessContext.lastaddcartSec=sessContext.lastaddcart?Math.round((object.defaults.nowTime-sessContext.lastaddcart)/1e3):null,allContext.lastPurchaseDays=allContext.lastPurchaseDays?Math.round((object.defaults.nowTime-allContext.lastPurchaseDays)/object.defaults.dayDuration):null,allContext.firstPurchaseDays=allContext.firstPurchaseDays?Math.round((object.defaults.nowTime-allContext.firstPurchaseDays)/object.defaults.dayDuration):null,allContext.lastVisitDays=allContext.lastVisitDays?Math.round((object.defaults.nowTime-allContext.lastVisitDays)/object.defaults.dayDuration):null,allContext.firstVisitDays=allContext.firstVisitDays?Math.round((object.defaults.nowTime-allContext.firstVisitDays)/object.defaults.dayDuration):null,object.User.context.session=sessContext,object.User.context.all=allContext,object.User.context.all.hasEmail=object.User.isIdentified(),object.User.context.all.hasPush=!!object.User.data.push,object.User.context.all.hasTel=!!object.User.data.tel,object.User.context.all.isCustomer=!!object.User.data.isC,object.User.context.all.noPurchases=object.User.data.noP||0,object.User.context.date=object.Helpers.dateContext(),object.Helpers.log("Done creating visitor context for "+trigger,"info"),session_is_new&&(object.User.requestUser(),object.state.eventQueue.push({update:{lastVisitDate:object.defaults.nowTime}}),object.shop.params.sessionJS)&&!object.state.runSessionJS){object.state.runSessionJS=!0,vtlodash.isArray(object.shop.params.sessionJS)||(object.shop.params.sessionJS=[object.shop.params.sessionJS]);for(var i=0;i<object.shop.params.sessionJS.length;i++)try{eval(object.shop.params.sessionJS[i])}catch(e){object.Helpers.log("Error running sessionJS "+i+": "+e.message,"error")}}return!0},domIsUpdated:function(){object.Helpers.log("Document changed, adding input listeners again","info"),object.Helpers.addEventListener("document","change",object.Helpers.inputEmailListening)},sendClickEvents:function(){object.Helpers.log("Start generate click events","info");var e,t,o=object.User.context.session.urlparams.vt_campaign,a=object.User.context.session.urlparams.vt_content;(o&&a&&object.shop.content.campaigns[o]||object.shop.campaigns[o]&&object.shop.campaigns[o].templatesPick.params[a]||object.shop.params.hasRunningAds&&object.shop.adserver.campaigns[o]&&object.shop.adserver.templates[a])&&(t={},(e=object.User.context.session.urlparams.vt_product)&&(t={itemId:e}),object.state.eventQueue.push(object.Campaign.createSiteEvent(object.defaults.siteEvents.click,o,a,t)),object.Helpers.log("Generate click for onsite: "+o+":"+a,"info"))},getVisitorInfo:function(){var e;!1!==object.shop.params.getVisitorInfo&&((e=object.Helpers.getCookie(object.defaults.cookieNames.visitor))?vtlodash.isObject(e)&&(object.User.context.session=vtlodash.merge(object.User.context.session,e)):vtlodash.request(object.defaults.visitorHost,function(e){vtlodash.isString(e)&&(e=JSON.parse(e)),vtlodash.isObject(e)&&(e={city:e.city,state:e.regionName,region_code:e.region,country:e.country,country_code:e.countryCode,org:e.org},object.Helpers.setCookie(object.defaults.cookieNames.visitor,e,object.defaults.monthDuration),object.User.context.session=vtlodash.merge(object.User.context.session,e))}))},callbackNull:function(e){object.Helpers.log("Callback without an active role","info")},callbackVisitor:function(e){vtlodash.isObject(e)&&(object.Helpers.setCookie(object.defaults.cookieNames.visitor,e,object.defaults.dayDuration),object.User.context.session=vtlodash.merge(object.User.context.session,e))},injectCss:function(e){object.shop.params.embedCSS&&(object.Helpers.embedTag("link","","head",{href:e,type:"text/css",rel:"stylesheet"}),object.Helpers.log("Injecting proprietary CSS into page","info"))},inputEmailListening:function(){if(!1!==object.shop.params.emailGrab){object.Helpers.log("Adding blur event listeners for every input field.","info");function e(e){var t={login:{email:object.Helpers.cleanEmail(e.target.value)}};object.shop.params.grabSource&&(t.login.source=object.shop.params.grabSource);try{var o;(o=e.target.form.id)&&(t.login.generic={form:o,input:e.target.id||""})}catch(e){}-1===e.target.className.indexOf(object.defaults.siteClasses.attr)&&object.Helpers.emailIsValid(e.target.value)&&object.state.eventQueue.push(t)}var t=object.shop.params.listenFields||"input[type=text],input[type=email],input[type=input]",o=document.querySelectorAll(t);for(i in o)o.hasOwnProperty(i)&&object.Helpers.addEventListener(o[i],"blur",e,!1)}},addReadyListener:function(o,a){var e;object.Helpers.log("Run ready for "+a,"info"),"complete"===documentAlias.readyState?(object.Helpers.log("Run loadHandler 0"+a,"info"),o()):(documentAlias.addEventListener?(object.Helpers.addEventListener(documentAlias,"DOMContentLoaded",function e(){object.Helpers.log("Run loadHandler 1"+a,"info"),o(),documentAlias.removeEventListener("DOMContentLoaded",e,!1)}),object.Helpers.log("Added ready for "+a,"info")):documentAlias.attachEvent&&(documentAlias.attachEvent("onreadystatechange",function e(){"interactive"!==documentAlias.readyState&&"loaded"!==documentAlias.readyState||(o(),documentAlias.detachEvent("onreadystatechange",e),object.Helpers.log("Run loadHandler 2"+a,"info"))}),documentAlias.documentElement.doScroll)&&windowAlias===windowAlias.top&&function t(){if(!object.state.hasLoaded){try{documentAlias.documentElement.doScroll("left")}catch(e){return void setTimeout(t,0)}object.Helpers.log("Run loadHandler 3"+a,"info"),o()}}(),new RegExp("WebKit").test(navigator.userAgent)?e=setInterval(function(){(object.state.hasLoaded||/loaded|complete/.test(documentAlias.readyState))&&(object.Helpers.log("Run loadHandler 4"+a,"info"),clearInterval(e),o())},10):(object.Helpers.log("Added load event listener at the end"+a,"info"),object.Helpers.addEventListener(windowAlias,"load",o,!1)))}},object.setVar=function(e,t,o){0!==o&&1!==o&&2!==o&&(o=0),/^[\s\/a-zA-Z0-9:.\-_;#$!@^&*=<>\\,|{}?]+$/.test(t)&&("VTuser"===e?(t&&t.indexOf("@")<0&&atob(t)&&(t=atob(t)),object.User.isIdentified()||object.User.changeUserByEmail(t)):"VTsid"===e?object.state._vtsid=t:object.User.context.vars[e]=t)},object.init=function(){if(!object.state.ready){object.state.ready=!0,object.state.storage=object.Helpers.getStorageType();try{var e=object.Helpers.getCookie(object.defaults.cookieNames.ts);e&&(object.state.timeDiff=e,object.defaults.nowTime=object.defaults.nowTimeLocal-e)}catch(e){console.log(e)}object.state.botagent=!1;try{object.state.botagent=/bot|googlebot|crawler|spider|robot|crawling/i.test(navigator.userAgent)}catch(e){object.Helpers.log("Error checking for bot agents!","error")}windowAlias.location.hostname.indexOf(object.shop.domain);try{var o;"undefined"!=typeof Prototype&&parseFloat(Prototype.Version.substr(0,3))<1.7&&void 0!==Array.prototype.toJSON&&(o=JSON.stringify,JSON.stringify=function(e){var t=Array.prototype.toJSON,e=(delete Array.prototype.toJSON,o(e));return Array.prototype.toJSON=t,e})}catch(e){}var e=object.Helpers.getCookie(object.defaults.cookieNames.debug);object.defaults.debug=object.shop.debug||object.defaults.debug,e&&(object.defaults.debug=e),object.Helpers.getCookie(object.defaults.cookieNames.stopevents)&&(object.defaults.stopevents=1),object.state.pageQueue=[],object.state.eventQueue=windowAlias._vteq||[],0<=windowAlias.location.search.indexOf("vt_preview=")?(e=object.Helpers.getURLParams(windowAlias.location.search),object.shop.params.embedCSS=!0,object.tasks.injectCss(object.defaults.stylesheet),object.defaults.debug="info",object.tasks.createUserContext(),object.tasks.createVisitorContext("p"),object.Campaign.embedCampaign(e.vt_campaign,e.vt_content,{vt_selector:window.atob(decodeURIComponent(e.vt_selector||""))})):(object.state.eventQueueId=setInterval(object.queueManager.eventsObserver,object.defaults.queueCheckInterval),object.tasks.createUserContext(!0),object.tasks.createVisitorContext("p"),object.state.webpush&&object.tasks.addReadyListener(object.webpush.instantiate,"wpins"),object.Campaign.statusObserver("p"),object.tasks.addReadyListener(object.Campaign.cacheBackendCheck,"cber"),object.tasks.addReadyListener(object.Campaign.processContentCampaigns,"emcon"),object.Helpers.vtPostMessage(),object.User.context.session.urlparams.vt_debug&&(object.Helpers.setCookie(object.defaults.cookieNames.debug,object.User.context.session.urlparams.vt_debug),object.defaults.debug=object.User.context.session.urlparams.vt_debug),1==object.User.context.session.urlparams.vt_stopevents?(object.Helpers.setCookie(object.defaults.cookieNames.stopevents,1),object.defaults.stopevents=1):0==object.User.context.session.urlparams.vt_stopevents&&object.Helpers.removeCookie(object.defaults.cookieNames.stopevents),object.tasks.checkUserIdentity(),object.tasks.createUserContext(),object.tasks.addReadyListener(function(){object.state.hasLoaded||(object.state.hasLoaded=!0,object.Helpers.log("Running onLoad functions","info"),object.tasks.inputEmailListening(),object.tasks.injectCss(object.defaults.stylesheet),object.tasks.runShopJS())},"loadh"),object.tasks.getVisitorInfo(),object.setVar("random",object.Helpers.generateRandomBetween(0,100,!0)),object.tasks.sendClickEvents(),object.tasks.followDataLayer(),object.Helpers.setAnalyticsUser(),object.state.timeDiff,object.User.activityInit(),(e=object.Helpers.getCookie(object.defaults.cookieNames.ne))&&("requser"==e?object.User.requestUser():object.state.eventQueue.push(e),object.Helpers.removeCookie(object.defaults.cookieNames.ne)),object.tasks.requestWebID(),object.Helpers.writeCookie(object.defaults.prefix+object.defaults.cookieNames.shop,object.shop.id))}},object}()),checkInit(),_vtshop={};
