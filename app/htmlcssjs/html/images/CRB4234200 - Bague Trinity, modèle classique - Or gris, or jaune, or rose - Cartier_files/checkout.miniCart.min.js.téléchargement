define([],function(){"use strict";return yTos.utils.namespace("yTos.helpers.Checkout.MiniCart"),yTos.helpers.Checkout.MiniCart=yTos.helpers.base.extend({initialize:function(){this._hideTimeout=null,this.isAddingItem=!1,this._isRemovingItem=!1,this._updateOnNextCall=!0,this.options.activeCheckoutType&&""!==this.options.activeCheckoutType||(this.options.activeCheckoutType="Checkout")},options:{showOnCartLinkMouseEnter:!0,toggleOnCartLinkClick:!1,showOnItemAdded:!0,hideOnItemAdded:!0,hideOnCartLinkMouseLeave:!0,hideOnMiniCartMouseLeave:!0,hideTimeoutFromCartLink:250,hideTimeoutFromMiniCart:250,hideTimeoutOnItemAdded:3e3,showIfEmpty:!1},events:{'[data-ytos-action="close"] click':"hide",'[data-ytos-action="gotocart"] click':"_goToCartPage"},globalMessages:{"yTos::Product::ProductAddedToShoppingBag":"_updateOnItemsAdded","yTos::Item::ItemAddedToShoppingBag":"_updateOnItemsAdded","yTos::Checkout::LinkToShoppingBagMouseEnter":"_cartLinkMouseEnterHandler","yTos::Checkout::ShoppingBagButtonMouseEnter":"_cartLinkMouseEnterHandler","yTos::Checkout::LinkToShoppingBagMouseLeave":"_cartLinkMouseLeaveHandler","yTos::Checkout::ShoppingBagButtonMouseLeave":"_cartLinkMouseLeaveHandler","yTos::Checkout::LinkToShoppingBagClicked":"_cartLinkClickHandler","yTos::Checkout::ShoppingBagButtonClicked":"_cartLinkClickHandler","yTos::Account::AddAllItemsFromWishListDone":"_updateOnItemsAdded","yTos::Checkout::SalesTaxEstimationSuccess":"forceShow","yTos::Checkout::RefreshMiniCart":"forceUpdate","yTos::Checkout::MoveItemToWishListSuccess":"_updateOnItemRemoved","yTos::WishList::ItemDeleted":"forceUpdate","yTos::Product::ProductAddedToWishlist":"forceUpdate","yTos::Item::ItemAddedToWishlist":"forceUpdate","yTos::Account::UserLoggedIn":"_updateAfterUserAuth","yTos::Account::UserLoggedOut":"_updateAfterUserAuth","yTos::Checkout::ItemAvailabilityRectified":"forceUpdate","yTos::Checkout::ShowMiniCart":"_appear","yTos::Checkout::HideMiniCart":"_disappear","yTos::Checkout::RemoveItemSuccess":"_updateOnItemRemoved"},form:{},_appear:function(){this.$el.addClass("open"),$Y.notify("yTos::Checkout::MiniCartVisible")},_disappear:function(){this.$el.removeClass("open"),$Y.notify("yTos::Checkout::MiniCartHidden")},show:function(a){(this.options.showIfEmpty||a)&&(this.notify("yTos::Checkout::ShowMiniCart"),this.update())},hide:function(){$Y.isVisible(this.el)&&this.$el.hasClass("open")&&this.notify("yTos::Checkout::HideMiniCart")},_cartLinkMouseEnterHandler:function(a){this.options.showOnCartLinkMouseEnter&&(this.options.hideOnCartLinkMouseLeave&&clearTimeout(this._hideTimeout),this.show(a.itemsInCart>0))},_cartLinkMouseLeaveHandler:function(){this.options.showOnCartLinkMouseEnter&&this.options.hideOnCartLinkMouseLeave&&(this._hideTimeout=setTimeout(this.hide.bind(this),this.options.hideTimeoutFromCartLink))},_cartLinkClickHandler:function(a){this.options.toggleOnCartLinkClick&&($Y.isVisible(this.el)&&this.$el.hasClass("open")?this.hide():this.show(a.itemsInCart>0))},_updateOnItemsAdded:function(){this.isAddingItem=!0,this.options.hideOnItemAdded&&$Y.watchOne({"yTos::Checkout::MiniCartUpdated":function(){this._hideTimeout=setTimeout(this.hide.bind(this),this.options.hideTimeoutOnItemAdded)}.bind(this)}),this.options.showOnItemAdded&&this.forceShow()},_updateOnItemRemoved:function(){this._isRemovingItem=!0,$Y.watchOne({"yTos::Checkout::MiniCartUpdated":function(){this._hideTimeout=setTimeout(this.hide.bind(this),this.options.hideTimeoutOnItemAdded)}.bind(this)}),this.forceShow()},_updateAfterUserAuth:function(){this._updateOnNextCall=!0,$Y.isVisible(this.el)&&this.update()},forceShow:function(){this.show(!0)},forceUpdate:function(){this.update(!0)},update:function(a){var b,c=this._updateOnNextCall||this.isAddingItem||this._isRemovingItem||a;c&&(b=this.isAddingItem?{isAddingItem:!0}:void 0,this.getHTML({Area:this.options.activeCheckoutType,Controller:"Cart",Action:"MiniCartContent"},{success:function(a){this.notify("yTos::Checkout::MiniCartUpdated",a)}.bind(this),autoUpdate:!0,data:b})),this.isAddingItem?(this.isAddingItem=!1,this._updateOnNextCall=!0):this._updateOnNextCall=!1,this._isRemovingItem=!1},_goToCartPage:function(a){a.preventDefault(),this.notify("yTos::Checkout::GoToCartClicked",{isDefaultBehaviourDisabled:this.options.preventDefaultBehaviour}),$Y.redirect(a.currentTarget.href)}}),yTos.helpers.Checkout.MiniCart});