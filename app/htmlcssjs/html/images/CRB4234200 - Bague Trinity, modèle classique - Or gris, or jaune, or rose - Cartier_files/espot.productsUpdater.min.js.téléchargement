define(["ytos.domlib","espot.updater"],function(a){"use strict";return yTos.utils.namespace("yTos.helpers.Espot.ProductsUpdater"),yTos.helpers.Espot.ProductsUpdater=yTos.helpers.Espot.Updater.extend({initialize:function(){this.sendBaynoteEspotProductClick()},refreshAfterInitialization:function(){this.options.shouldAvoidRefreshAfterInitialization||this.updateEspot({color:{ProductId:this.options.productId}})},events:{"[data-ytos-related] click":"manageClick"},globalMessages:{"yTos::Common::RecommendationEngineFeedbackReady":"updateEspot","yTos::Common::RecommendationEngineFeedbackFailed":"updateEspot","yTos::Common::SkipRecommendationEngine":"updateEspot"},localMessages:function(){return this.options.shouldUpdateWhenColorChange?{"yTos::Product::SelectedColorChanged":"updateEspot"}:{}},updateEspot:function(a){var b=$Y.pick(["viewName","espotName","updateRoute","siteCode","partNumber","locale"],this.options);b.productId=this.options.productId,b.shouldUpdateWhenColorChange=this.options.shouldUpdateWhenColorChange,b.shouldBeCached=this.options.shouldBeCached,a&&(b.productId=a.hasOwnProperty("color")?a.color.ProductId:b.productId,a.hasOwnProperty("engineProvider")&&(b.recommendationEngineUserId=a.userId)),this._internalUpdate(b)},manageClick:function(b){b.preventDefault();var c=a(b.currentTarget),d=c.find("a[data-ytos-action]"),e=d.data("ytosAction"),f=c.data("ytosRelated"),g=d.attr("href"),h="",i=c.find("[data-ytos-slot]").data("ytos-slot");this.notify("yTos::Espot::ProductClicked",{currentCode10:h,newCode10:f}),this.storeRelatedItemData(f,i),this.trackEspotProductClick(e,h,f),this._redirectTo(g)},trackEspotProductClick:function(a,b,c){yTos.tracking.trackEvent({event:"related"===a?"RelatedTo":a,label:b+"_"+c})},storeRelatedItemData:function(a,b){$Y.storage.isAvailable()&&$Y.storage.set("baynoteClickedItemData",{partNumber:a,slot:b,template:""})},sendBaynoteEspotProductClick:function(){var a=$Y.storage.get("baynoteClickedItemData");a&&this.postHTML("/yTos/api/Plugins/EspotPluginApi/SendBaynoteClickEvent",{data:a,success:function(){this.notify("yTos::Espot::sendBaynoteProductClickTrackingSuccess",{},{scope:this.scope}),$Y.storage.del("baynoteClickedItemData")}.bind(this),error:function(){this.notify("yTos::Espot::sendBaynoteProductClickTrackingError",{},{scope:this.scope})}.bind(this)})},_redirectTo:function(a){$Y.redirect(a)}}),yTos.helpers.Espot.ProductsUpdater});